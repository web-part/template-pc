!function(e,t,n,r,i,s,o,l,a,u,c,f,d,h,p,g,m,y,w,x,v,b,j,k,C,S){const T=function(){const e={},t={};return{define:function(t,n){e[t]=n},require:function n(r){let i=t[r];if(i)return i;let s={exports:{},require:e=>n(`${r}/${e}`)};return(i=(0,e[r])(n,s,s.exports))===S&&(i=s.exports),t[r]=i,i},each(t){j.keys(e).forEach(t)}}}(),q=T.define,M=function({require:e}){let t=null;function n(){if(t)return t;const n=e("ModuleManager");return t=new n({cross:!0})}return{create:n,has:function(...e){return n().has(...e)},define:function(...e){return n().define(...e)},require:function(...e){return n().require(...e)},bind:function(e,t,r){return function(...i){var s=n().require(e),o=s[t];if("function"!=typeof o)throw new m(`要绑定的模块 ${e} 中不存在名为 ${t} 的方法或函数。`);return r=!0===r?s:r||null,o.call(r,...i)}}}}(T),I=M.define;q("ModuleManager/Module",function(e,t,n){const r=new x;t.exports=class{constructor(e,t){let n=t.seperator,i=e.split(n),s=i.slice(-1)[0],o=t.parent;o&&(o=j.create(o,{require:{value:function(t){throw new m(`禁止通过父模块来加载同级模块：模块 ${e} 尝试加载同级模块 ${t}。`)}}}));let l={id:e,seperator:n,emitter:t.emitter,mm:t.mm,this:this};r.set(this,l),j.assign(this,{id:e,name:s,names:i,seperator:n,data:t.data,exports:t.exports,parent:o})}on(...e){let t=r.get(this).emitter;t&&t.on(...e)}require(e){let t=r.get(this),n=t.seperator,i=t.id+n+e;if(e.includes(n))throw new m(`模块 ${t.id} 不允许跨级加载模块: ${i}`);return t.mm.require(i,!0)}bind(e,t){let n="object"==typeof e?e:{[e]:t},i=r.get(this);j.keys(n).forEach(function(e){let t=n[e],r="function"==typeof t?t:function(e){e.on(t)};i.this.on("require",e,r)})}render(e,...t){let n=this.require(e);if(!n)throw new m(`模块 ${meta.id} 不存在名为 ${e} 的直接子模块`);return n.render(...t),n}}}),q("ModuleManager.defaults",function(e,t,n){t.exports={Emitter:null,seperator:"/",cross:!1,repeated:!1}}),q("ModuleManager",function(e,t,n){const r=t.require("Module"),i=new x;class s{constructor(e){let t=j.assign({},n.defaults,e),r=t.Emitter,s=r?new r(this):null,o={id$module:{},id$data:{},seperator:t.seperator,cross:t.cross,repeated:t.repeated,emitter:s,Emitter:r,this:this,require:e=>o.this.require(e),fire(...e){s&&s.fire(...e)},getParent(e){let t=o.seperator,n=e.split(t);if(1==n.length)return null;let r=n.slice(0,-1).join(t);return o.id$module[r]||null}};i.set(this,o),this.on("require",function(e,t,n){t.fire("require",[n]);let r=t.parent;r&&r.fire("require",t.name,[n])})}data(e,t){if("string"!=typeof e)throw new m("参数 id 为要设置的模块的 id，必须为 string 类型。");return i.get(this).id$data[e]=t,t}define(e,t){if("string"!=typeof e)throw new m(`参数 id 的类型必须为 string，当前为: ${typeof e}`);let n=i.get(this),r=n.id$module;if(!n.repeated&&r[e])throw new m(`配置设定了不允许定义重复的模块: 已存在名为 ${e} 的模块`);let s=n.Emitter,o=s?new s:null,l=e.split(n.seperator).slice(-1)[0];r[e]={id:e,name:l,factory:t,emitter:o,parent:null,required:!1,count:0,exports:null,mod:null,fire(){o&&o.fire(...arguments)}}}require(e,t){if("string"!=typeof e)throw new m(`参数 id 的类型必须为 string，当前为: ${typeof e}`);let n=i.get(this),s=n.seperator;if(t===S&&(t=n.cross),!t&&e.includes(s))throw new m(`参数指定了或配置设定了不允许跨级加载模块: ${e}`);if(!this.has(e))return;let o=n.id$module[e];if(o.count++,o.required)return o.exports;o.required=!0;let l=o.factory,a=o.parent=n.getParent(e);if("function"!=typeof l)return o.exports=l,n.fire("require",e,[o,l]),n.fire("require",[e,o,l]),l;let u=o.exports={},c=o.mod=new r(e,{seperator:s,mm:this,emitter:o.emitter,data:n.id$data[e],exports:u,parent:a?a.mod:null});return(u=l(n.require,c,u))===S&&(u=c.exports),o.exports=u,c.exports=u,n.fire("require",e,[o,u]),n.fire("require",[e,o,u]),u}on(...e){let t=i.get(this).emitter;t&&t.on(...e)}has(e){return i.get(this).id$module.hasOwnProperty(e)}destroy(){let e=i.get(this).emitter;e&&e.destroy(),i.delete(this)}}s.defaults=e("ModuleManager.defaults"),t.exports=n=s}),I("Defaults",function(e,t,n){const r=e("Object"),i={},s={},o="__hooked_for_defaults__";t.exports=n={set(e,t){if(h.isArray(e)){return void e.forEach(function(e){n.set(e,t)})}if(r.isPlain(e)){let t=e;return void r.each(t,function(e,t){n.set(e,t)})}let l=i[e];if(l)return void r.deepAssign(l,t);let a=s[e];if(a)return void r.deepAssign(a,t);s[e]=r.deepAssign({},t);let u=M.create();if(!u.require[o]){let e=u.require.bind(u);u.require=function(t){let n=e(t);if(t.endsWith(".defaults")){let e=t.slice(0,-".defaults".length),o=s[e],l=n;i[e]=r.deepAssign(l,o)}return n},u.require[o]=!0}},get(t){let n=i[t];return n||(n=i[t]=e(`${t}.defaults`)),n},config(...e){if(1==e.length&&"string"==typeof e[0])return n.get(...e);n.set(...e)}}}),I("Object",function(e,t,n){t.exports=n={deepAssign:(e,...t)=>(t.forEach(t=>{e=function e(t,r){t=t||{};for(let i in r){let s=t[i],o=r[i];n.isPlain(o)&&(o=e(s=n.isPlain(s)?e({},s):{},o)),t[i]=o}return t}(e,t)}),e),isEmpty(e){for(let t in e)return!1;return!0},isPlain(e){if(!e||"object"!=typeof e)return!1;var t,n=j.prototype.hasOwnProperty,r=e.constructor;try{if(r&&!n.call(e,"constructor")&&!n.call(r.prototype,"isPrototypeOf"))return!1}catch(e){return!1}for(t in e);return t===S||n.call(e,t)},flat(e){let t=n.isPlain,r=[];if(!e||!t(e))return r;let i=[];return function e(n,s){for(let o in n){let l=n[o];(i=i.slice(0,s)).push(o),t(l)?e(l,s+1):r.push({keys:i,value:l})}}(e,0),r},grep(e,t){let n={};for(let r in e){let i=e[r];!0===t(r,i)&&(n[r]=i)}return n},each(e,t,r){"boolean"!=typeof e&&(r=t,t=e,e=!1);for(let i in t){let s=t[i];if(!1===r(i,s,t))break;!0===e&&s&&"object"==typeof s&&n.each(!0,s,r)}},map(e,t,r){"boolean"!=typeof e&&(r=t,t=e,e=!1);let i=n.isPlain,s=n.map,o={};for(let n in t){let l=t[n];e&&i(l)?o[n]=s(!0,l,r):o[n]=r(n,l,t)}return o},make(e,t,n){if(h.isArray(e)&&(n=t,t=e,e={}),!e||"object"!=typeof e)throw new m("参数 obj 必须为一个非空的对象，以作为容器对象。");let r=e,i=t.length-1;return t.map(function(e,t){let s=r[e];t<i?r=r[e]="object"==typeof s&&s||{}:r[e]=n}),e},filter(e,t){let r={};if(h.isArray(t))t.forEach(function(t,n){t in e&&(r[t]=e[t])});else if(n.isPlain(t))n.each(t,function(t,n){t in e&&(r[t]=e[t])});else{if("string"!=typeof t)throw new m("无法识别参数 samples 的类型");{let n=t;n in e&&(r[n]=e[n])}}return r},delete(e,t){let n=j.assign({},e);if("string"==typeof t)delete n[t];else if(h.isArray(t))for(let e=0,r=t.length;e<r;e++)delete n[t[e]];else for(let e in t)delete n[e];return n},sort(e,t,r){if("boolean"!=typeof e&&(r=t,t=e,e=!1),!t)return t;r=r||S;let i={};return j.keys(t).sort(r).forEach(s=>{let o=t[s];e&&n.isPlain(o)&&(o=n.sort(e,o,r)),i[s]=o}),i}}}),I("AppModule.defaults",function(e,t,n){const r=e("Emitter");t.exports={Emitter:r,seperator:"/",repeated:!1,cross:!1}}),I("AppModule",function(e,t,n){const r=e("ModuleManager"),i=e("Object"),s=e("String");let o={},l=null;function a(){return l||(l=new r(n.defaults)),l}t.exports=n={defaults:e("AppModule.defaults"),mm:a,define(e,t){e.includes("{")&&e.includes("}")?o[e]=t:a().define(e,t)},require:(...e)=>a().require(...e),on:(...e)=>a().on(...e),has:(...e)=>a().has(...e),data(e,t){if(h.isArray(e)){return e.forEach(e=>{a().data(e,t)}),t}if(i.isPlain(e)){let t=e;return i.each(t,function(e,t){a().data(e,t)}),t}return a().data(e,t)},fill(e,t){i.each(o,function(n,r){n.startsWith(e)&&(n=s.format(n,t),u.log(`动态定义模块: ${n}`),a().define(n,r))})}},n.define.has=n.has}),I("Emitter",function(e,t,n){const r=e("Object"),i=e("Tree"),s=new x;t.exports=class{constructor(e){let t={context:e,tree:new i};s.set(this,t)}on(e,t){if(h.isArray(e))return void(t?e.map(function(e){this.on(e,t)},this):this.on(...e));let n=s.get(this).tree,i=h.from(arguments),o=i.findIndex(function(e,t){return"object"==typeof e});if(o>=0){let e=i[o],t=i.slice(0,o);return void r.flat(e).forEach(function(e,r){let i=t.concat(e.keys),s=n.get(i)||{list:[],count:0};s.list.push(e.value),n.set(i,s)})}if((o=i.findIndex(function(e,t){return"function"==typeof e}))<0)throw new m("参数中必须指定一个回调函数");t=i[o];let l=i.slice(0,o),a=n.get(l)||{list:[],count:0,enabled:!0,spreaded:!0};a.list.push(t),n.set(l,a)}off(e,t){var n=s.get(this).tree,i=h.from(arguments);if(0!=i.length)if((a=i.findIndex(function(e,t){return"object"==typeof e}))>=0){var o=i[a],l=i.slice(0,a);(u=r.flat(o)).forEach(function(e,t){var r=l.concat(e.keys),i=n.get(r);if(i){var s=i.list;if(s&&s.length){var o=e.value;i.list=s.filter(function(e){return e!==o})}}})}else{var a;(a=i.findIndex(function(e,t){return"function"==typeof e}))<0&&(a=i.length),t=i[a],l=i.slice(0,a);var u,c=n.get(l);c&&(u=c.list)&&u.length&&(t?c.list=u.filter(function(e,n){return e!==t}):u.length=0)}else n.clear()}fire(e,t){let n=s.get(this);n||u.log(arguments,this.id);let r=n.context,i=[...arguments],o=i.findIndex(function(e,t){return h.isArray(e)});o<0&&(o=i.length);let l=i.slice(0,o),a=n.tree.get(l),c=[];return a?(t=i[o]||[],a.count++,a.list.forEach(function(e,n){let i=e.apply(r,t);c.push(i)}),c):c}has(...e){let t=s.get(this).tree.get([...e]);return t&&t.list&&t.list.length>0}set(e,t){let n=s.get(this);switch(e){case"context":n[e]=t;break;default:throw new m("不支持设置属性: "+e)}}destroy(){s.get(this).tree.destroy(),s.delete(this)}}}),I("Tree/Node",function(e,t,n){let r=0;t.exports=n={create(e=[],t=null){let n=e.slice(-1)[0],i=`node-${r++}`,s=e.length,o=t?t.nodes:[];return{id:i,y:s,x:0,key:n||"",keys:e,parent:t,isRoot:!t,key$node:{},nodes:[],siblings:o}},set(e,t,r){let i=e,s=t.length-1,o=[];return t.forEach(function(e,l){let a=i.key$node[e];if(!a){let r=t.slice(0,l+1);a=n.create(r,i),i.key$node[e]=a,i.nodes.push(a),o.push(a),a.x=a.siblings.length-1}l<s?i=a:a.value=r}),o},get(e,t){let{key$node:n}=e,r=t.length-1;for(let e=0;e<=r;e++){let i=n[t[e]];if(!i||e==r)return i||null;n=i.key$node}},each(e,t){let{nodes:r}=e;r.length&&r.some(e=>{if(!1===t(e))return!0;n.each(e,t)})}}}),I("Tree",function(e,t,n){const r=t.require("Node"),i=new x;t.exports=class{constructor(e,t){const n={root:r.create(),nodes:[],id$node:{},this:this};i.set(this,n),h.isArray(e)&&(t=t||"/",e.forEach(e=>{let r=e.split(t);n.this.set(r)}))}render(e=[]){let t={},n=[],r=h(5).join(" ");return this.each(e,function(e){let{id:i,x:s,y:o,key:l,siblings:a,parent:u}=e,c=s<a.length-1,f=`${c?"├──":"└──"} ${l}`,d=o>1?h(o).join(r):"";if(u&&!u.isRoot){let e=t[u.id],n=e.hasNextSibling?"│":"";d=e.tabs+n+r.slice(1)}t[i]={hasNextSibling:c,tabs:d,content:f},n.push(`${d}${f}`)}),n}set(e,t){let n=i.get(this);r.set(n.root,e,t).forEach(e=>{let{id:t}=e;n.id$node[t]=e,n.nodes.push(e)})}get(e){let t=i.get(this),n=r.get(t.root,e);return n?n.value:S}has(e){let t=i.get(this);return!!r.get(t.root,e)}each(e,t){if("function"==typeof e&&(t=e,e=[]),"function"!=typeof t)throw new m("参数 fn 必须为一个函数。");let n=i.get(this).root,s=e.length>0?r.get(n,e):n;if(!s)throw new m(`不存在路径为 ${e.join(".")} 的节点。`);r.each(s,t)}clear(){let e=i.get(this);e.root=r.create([],null),e.nodes=[],e.id$node={}}remove(e){let t=i.get(this),n=r.get(t.root,e);n&&delete n.value}destroy(){i.delete(this)}}}),I("String",function(e,t,n){t.exports=n={format(e,t){let r=e,i=n.replaceAll,s=(e,t,n)=>(h.isArray(n)&&(n=n.join("")),e=i(e,`{${t}}`,n));if("object"==typeof t)for(let e in t)r=s(r,e,t[e]);else{[...arguments].slice(1).forEach(function(e,t){r=s(r,e,t)})}return r},replaceAll:(e,t,n)=>e.split(t).join(n),replaceBetween(e,t,n,r){if("object"==typeof t){let e=t;t=e.begin,n=e.end,r=e.value}if(e.indexOf(t)<0||e.indexOf(n)<0)return e;return e=e.split(t).map(function(e){let t=e.split(n);return 1==t.length?t[0]:r+t.slice(1).join(n)}).join("")},padLeft(e,t,n){let r=(e=C(e)).length;if(t<=r)return e.substr(-t);n=n||" ";let i=[];return i.length=t-r+1,i.join(n)+e},padRight(e,t,n){let r=C(e),i=r.length;if(i>=t)return r.substring(0,t);n=n||" ";let s=[];return s.length=t-i+1,r+s.join(n)},between(e,t,n){let r=e.indexOf(t);if(r<0)return"";r+=t.length;let i=e.indexOf(n,r);return i<0?"":e.substr(r,i-r)},random(e){if(e===S&&(e=12),"number"==typeof e){let t=e+1;t<0&&(t=0),(e=[]).length=t,e=e.join("x")}return e.replace(/x/g,function(e){return(16*v.random()|0).toString(16)}).toUpperCase()},randomId:(...e)=>(e=e.map(function(e,t){return"number"==typeof e&&(e=(e=n.random(e)).toLowerCase()),e})).join(""),toCamelCase:e=>e.replace(/^-ms-/,"ms-").replace(/-([a-z]|[0-9])/gi,function(e,t){return t.toString().toUpperCase()}),toHyphenate:e=>e.replace(/[A-Z]/g,function(e){return"-"+e.charAt(0).toLowerCase()}),toUtf8(e){let t=[];return e.split("").forEach(function(e,n){let r=e.charCodeAt(0);r<128?t.push(r):r<2048?(t.push((1984&r)>>6|192),t.push(63&r|128)):(t.push((61440&r)>>12|224),t.push((4032&r)>>6|128),t.push(63&r|128))}),"%"+(t=t.map(function(e,t){return e.toString(16)})).join("%")},toValue(e){if("string"!=typeof e)return e;let t={true:!0,false:!1,null:null,undefined:S,NaN:NaN};return e in t?t[e]:e},split(e,t){let n=C(e).split(t[0]);for(let e=1,i=t.length;e<i;e++)n=r(n,t[e],e);return n;function r(e,t,n){return n--,e.map(function(e,i){return 0==n?C(e).split(t):r(e,t,n)})}},getByteLength:e=>e?e.toString().replace(/[\u0100-\uffff]/g,"  ").length:0}}),I("Array",function(e,t,n){t.exports=n={map(e,t,r){"boolean"!=typeof e&&(r=t,t=e,e=!1);let i=n.map,s=[];for(let n=0,o=t.length;n<o;n++){let o,l=t[n];if(!0===e&&h.isArray(l))o=i(!0,l,r);else{if(null===(o=r(l,n)))continue;if(o===S)break}s.push(o)}return s},slide(e,t,n=1){let r=e.length;if(r<=t)return[e];let i=[];for(let s=0;s<r;s+=n){let n=s+t,o=e.slice(s,n);if(i.push(o),n>=r)break}return i},group(e,t,r){let i=n.slide(e,t,t);return!0===r&&(i[i.length-1]=e.slice(-t)),i},pad(e,t,n,r){if(e==t)return[];"function"==typeof n?(r=n,n=1):n=v.abs(n||1);let i=[],s=0;if(e<t)for(let o=e;o<t;o+=n){let e=r?r(o,s):o;i.push(e),s++}else for(let o=e;o>t;o-=n){let e=r?r(o,s):o;i.push(e),s++}return i}}}),I("Date",function(e,t,n){const r=e("String");let i=0;function s(e){let t=e.indexOf(".")>0?".":e.indexOf("-")>0?"-":e.indexOf("/")>0?"/":e.indexOf("_")>0?"_":null;if(!t)return null;let n=e.split(t);return{yyyy:n[0],MM:n[1]||0,dd:n[2]||1}}function o(e){let t=e.indexOf(":")>0?":":null;if(!t)return null;let n=e.split(t);return{HH:n[0]||0,mm:n[1]||0,ss:n[2]||0}}t.exports=n={parse(e){if(e instanceof g){let t=e.getTime();return isNaN(t)?null:e}let t=!1;switch(typeof e){case"number":let n=new g(e),r=n.getTime();return isNaN(r)?null:n;case"string":t=!0}if(!t)return null;let n=new g(e);if(!isNaN(n.getTime()))return n;let r=e.split(" "),i=r[0];if(!i)return null;let l=(n=i.indexOf(":")>0?null:i)?r[1]||null:n;if(!n&&!l)return null;if(n&&l){let e=s(n),t=o(l);return new g(e.yyyy,e.MM-1,e.dd,t.HH,t.mm,t.ss)}if(n){let e=s(n);return new g(e.yyyy,e.MM-1,e.dd)}if(l){let e=new g,t=o(l);return new g(e.getFullYear(),e.getMonth(),e.getDate(),t.HH,t.mm,t.ss)}},format(e,t){1==arguments.length?(t=e,e=new g):e=n.parse(e);let i=e.getFullYear(),s=e.getMonth()+1,o=e.getDate(),l=e.getHours(),a=e.getMinutes(),u=e.getSeconds(),c=function(e,t){return r.padLeft(e,t,"0")},f=l<=12,d=t;return[["yyyy",c(i,4)],["yy",C(i).slice(2)],["MM",c(s,2)],["M",s],["dddd","星期"+"日一二三四五六".charAt(e.getDay())],["dd",c(o,2)],["d",o],["HH",c(l,2)],["H",l],["hh",c(f?l:l-12,2)],["h",f?l:l-12],["mm",c(a,2)],["m",a],["ss",c(u,2)],["s",u],["tt",f?"AM":"PM"],["t",f?"A":"P"],["TT",f?"上午":"下午"],["T",f?"上":"下"]].forEach(function(e,t){d=r.replaceAll(d,e[0],e[1])}),d},add(e,t,r){let i=(e=n.parse(e)).getMilliseconds(),s=new g(e);return s.setMilliseconds(i+t),r&&(s=n.format(s,r)),s},addSeconds:(e,t,r)=>n.add(e,1e3*t,r),addMinutes:(e,t,r)=>n.addSeconds(e,60*t,r),addHours:(e,t,r)=>n.addMinutes(e,60*t,r),addDays:(e,t,r)=>n.addHours(e,24*t,r),addWeeks:(e,t,r)=>n.addDays(e,7*t,r),addMonths(e,t,r){e=n.parse(e);let i=new g(e),s=e.getMonth();return i.setMonth(s+t),r&&(i=n.format(i,r)),i},addYears:(e,t,r)=>n.addMonths(e,12*t,r),set(e){let t=n.parse(e);if(!t)throw new m("无法识别的日期时间格式: "+e);i=t-g.now()},get(e){let t=new g;return 0!=i&&(t=n.add(t,i)),e&&(t=n.format(t,e)),t}}}),I("Escape",function(e,t,n){t.exports=n={html(e){var t=C(e);return t=(t=(t=(t=(t=t.replace(/[&'"<>\/\\\-\x00-\x09\x0b-\x0c\x1f\x80-\xff]/g,function(e){return"&#"+e.charCodeAt(0)+";"})).replace(/ /g,"&nbsp;")).replace(/\r\n/g,"<br />")).replace(/\n/g,"<br />")).replace(/\r/g,"<br />")},attribute:e=>C(e).replace(/[&'"<>\/\\\-\x00-\x1f\x80-\xff]/g,function(e){return"&#"+e.charCodeAt(0)+";"}),script(e){var t=C(e);return t=(t=(t=(t=(t=t.replace(/[\\"']/g,function(e){return"\\"+e})).replace(/%/g,"\\x25")).replace(/\n/g,"\\n")).replace(/\r/g,"\\r")).replace(/\x01/g,"\\x01")},query(e){var t=C(e);return escape(t).replace(/\+/g,"%2B")},hrefScript(e){var t=n.escapeScript(e);return t=t.replace(/%/g,"%25"),t=n.escapeElementAttribute(t)},regexp:e=>C(e).replace(/[\\\^\$\*\+\?\{\}\.\(\)\[\]]/g,function(e,t){return"\\"+e})}}),I("Fn",function(e,t,n){const r=e("Math");t.exports={noop:(...e)=>e[0],delay(e,t,n){if(!t)return;if(!1===e||null==e)return void t.apply(null,n);let i="number"==typeof e?e:r.randomInt(e.min,e.max);return f(function(){t.apply(null,n)},i)},exec:e=>new y(`\n                return (function () { \n                    ${e}\n                })();\n            `)()}}),I("Math",function(e,t,n){t.exports=n={randomInt(e,t){let n=arguments.length;if(0==n)return b(C(v.random()).replace(".","").replace(/^0*/g,""));1==n&&(t=e,e=0);let r=t-e+1;return v.floor(v.random()*r+e)},slide:(e,t,n)=>(e+=n=n||1)>=0?e%t:(t-v.abs(e)%t)%t,next:(e,t)=>n.slide(e,t,1),previous:(e,t)=>n.slide(e,t,-1),parsePercent(e){if("string"!=typeof e)return e;let t=e.trim();return"%"!=t.slide(-1)?e:parseFloat(t)/100}}}),I("Hash",function(e,t,n){const r=e("Object"),i=e("Query");t.exports=n={get(e,t,n){if("object"==typeof e){let t=null;if("href"in e)t=e;else{if(!("location"in e))throw new m("当参数 url 是一个 Object 类型时，只能是浏览器环境中的 location 或 window 对象。");t=e.location}e=t.href}let r=e.indexOf("#");if(r<0)return;let s=e.length,o=e.slice(r+1,s);if(o=unescape(o),""===t)return o;let l=i.parse(o);if(t===S)return l;if(!n||t in l)return l[t];t=t.toString().toLowerCase();for(let e in l)if(e.toLowerCase()==t)return l[e]},set(e,t,n){let s=null;if("object"==typeof e){if("href"in e)s=e;else{if(!("location"in e))throw new m("当参数 url 是一个 Object 类型时，只能是浏览器环境中的 location 或 window 对象。");s=e.location}e=s.href}let o=typeof t,l=/^(string|number|boolean)$/.test(o),a="";if(2==arguments.length&&l)a=C(t);else{let e="object"==o?t:r.make(t,n);a=i.stringify(e)}a=escape(a);let u=e.lastIndexOf("#");return u>-1&&(e=e.slice(0,u)),e=e+"#"+a,s&&(s.hash=a),e},has(e,t,i){if("object"==typeof e){let t=null;if("href"in e)t=e;else{if(!("location"in e))throw new m("当参数 url 是一个 Object 类型时，只能是浏览器环境中的 location 或 window 对象。");t=e.location}e=t.href}let s=n.get(e);if(!s)return!1;if(!t)return!r.isEmpty(s);if(t in s)return!0;if(i){t=t.toString().toLowerCase();for(let e in s)if(e.toLowerCase()==t)return!0}return!1},onchange(e,t,r){"function"==typeof t&&(r=t,t=!1);let i=n.get(e,"");t&&r.call(e,i,null,t),e.addEventListener("hashchange",function(){let t=i;i=n.get(e,""),r&&r(i,t,!1)})}}}),I("Query",function(e,t,n){const r=e("Object"),i=e("String");function s(e,t){"object"==typeof(t=t||"")&&(t=n.stringify(t)),t&&(t="?"+t);var r=e.includes("?"),i=e.includes("#"),s=[];return r&&i?(s=e.split(/\?|#/g))[0]+t+"#"+s[2]:r?(s=e.split("?"))[0]+t:i?(s=e.split("#"))[0]+t+"#"+s[1]:e+t}t.exports=n={parse(e,t,r){if(!e||"string"!=typeof e)return{};var s=r?unescape:decodeURIComponent,o=!t;const l=i.toValue;var a={};return e.split("&").map(function(e){var t=e.split("="),r=s(t[0]),i=t[1];if(t.length>1&&(i=s(i),i=o&&i.indexOf("=")>0?n.parse(i):l(i)),r in a){var u=a[r];h.isArray(u)?u.push(i):a[r]=[u,i]}else a[r]=i}),a},stringify(e,t){if(null==e)return C(e);switch(typeof e){case"string":case"number":case"boolean":return e}if(e instanceof C||e instanceof b||e instanceof p||e instanceof g)return e.valueOf();if(h.isArray(e))return"["+e.join(", ")+"]";let i=t?escape:encodeURIComponent,s=[];return r.each(e,function(e,t){e=i(e),t!==S?(t=n.stringify(t),t=i(t),s.push(`${e}=${t}`)):s.push(e)}),s.join("&")},get(e,t,r){"object"==typeof e&&(e="href"in e?e.href:e.location.href);let i=e.indexOf("?");if(i<0)return;let s=e.indexOf("#");s<0&&(s=e.length);let o=e.slice(i+1,s);if(""===t)return decodeURIComponent(o);let l=n.parse(o);if(t===S)return l;if(!r||t in l)return l[t];t=t.toString().toLowerCase();for(let e in l)if(e.toLowerCase()==t)return l[e]},add(e,t,r){var i=n.get(e)||{};"object"==typeof t?j.assign(i,t):i[t]=r;var s={};for(let e in i){let t=i[e];null!==t&&(s[e]=t)}return n.set(e,s)},remove(e,t){let r=null;"object"==typeof e&&(e=(r="href"in e?e:e.location).href);let i="";return t&&delete(i=n.get(e))[t],e=s(e,i),r&&(r.href=e),e},random(e,t){var r=i.random(t);return n.add(e,r,S)},set(e,t,n){var r=null;"object"==typeof e&&(e=(r="href"in e?e:e.location).href);var i=typeof t,o=/^(string|number|boolean)$/.test(i);return e=s(e,2==arguments.length&&o?encodeURIComponent(t):"object"==i?t:{[t]:n}),r&&(r.href=e),e},has(e,t,i){"object"==typeof e&&(e="href"in e?e.href:e.location.href);var s=n.get(e);if(!s)return!1;if(!t)return!r.isEmpty(s);if(t in s)return!0;if(i){t=t.toString().toLowerCase();for(let e in s)if(e.toLowerCase()==t)return!0}return!1},escape(e){var t=C(e);return escape(t).replace(/\+/g,"%2B")}}}),I("JSON",function(e,t,n){t.exports={parse(e){try{return w.parse(e)}catch(e){u.warn("使用原生的 JSON.parse() 方法无法解析。")}try{let t=["return (function () { ","   var obj = "+e+";","   return obj;","})();"].join("\r\n");return new y(t)()}catch(e){u.warn("使用 new Function() 方法无法解析。")}return null},stringify:(...e)=>w.stringify(...e)}}),I("Style",function(e,t,n){const r=e("Object");function i(e){if("number"==typeof e)return e+"px";if("string"==typeof e){let t=/^\d+px$/g.test(e),n=/^\d+em$/g.test(e),r=/^\d+rem$/g.test(e),i=/^\d+%$/g.test(e);if(t||n||r||i)return e;let s=parseInt(e);return isNaN(s)?e:s+"px"}return e}t.exports=n={objectify(e){if(!e)return{};if("object"==typeof e)return e;if("string"!=typeof e)return{};let t={};return e.split(";").forEach(function(e){if(!(e=(e=e.trim()).replace(/\n/g,"")))return;let n=e.split(":"),r=n[0].trim(),i=n[1].trim();t[r]=i}),t},stringify(e,t,i){if(!e)return"";"string"==typeof e&&(e=n.objectify(e)),"number"==typeof t&&(i=t,t=null);let s=[];return r.each(e,function(e,n){if(null==(n=t?t(e,n):n)||""===n)return;let r=e+": "+n;i&&(r=new h(i+1).join(" ")+r),s.push(r)}),0==s.length?"":e=i?s.join("; \n")+"; \n":s.join("; ")+"; "},pixelize:(e,t)=>"object"==typeof e||t?(t=t||[],e=n.objectify(e),e=r.map(e,function(e,n){return t.includes(e)?i(n):n})):i(e),trim(e){let t={};return r.each(e,function(e,n){null!=n&&""!==n&&(t[e]=n)}),t},merge:(...e)=>(e=e.map(function(e){return e?e=n.trim(e):{}}),j.assign(...e))}}),I("Tasker",function(e,t,n){const r=e("Emitter"),i=new x,s={};class o{constructor(e){let t={emitter:new r(this),list:e||[]};i.set(this,t)}parallel(e){let t=i.get(this);if(!(e=e||t.list).length)return void t.emitter.fire("all",[[]]);let n=e.length,r=n,s=new h(n),o=new h(n);e.forEach(function(e,i){!function(i){t.emitter.fire("each",[e,i,function(e){if(s[i]=e,o[i]=!0,!(--r>0)){for(let e=0;e<n;e++)if(!o[e])return;t.emitter.fire("all",[s])}}])}(i)})}serial(e){let t=i.get(this);if(!(e=e||t.list).length)return void t.emitter.fire("all",[]);let n=e.length,r=new h(n);!function i(s){let o=e[s];t.emitter.fire("each",[o,s,function(e){r[s]=e,++s<n?i(s):t.emitter.fire("all",[r])}])}(0)}on(...e){i.get(this).emitter.on(...e)}}j.assign(o,{todo(e,t,n){let r=s[e];r?r.push(t):(r=s[e]=[t],n(function(t){return s[e]=null,"function"==typeof t&&r.forEach(function(e,n){t(e,n)}),r}))}}),t.exports=o}),I("Timer",function(e,t,n){const r=new x;t.exports=class{constructor(){r.set(this,{t0:0,list:[]})}start(){r.get(this).t0=new g}stop(e="ms"){let t=r.get(this),n=t.t0,i=new g,s=i-n,o=0,l={t0:n,t1:i,dt:s,value:0,unit:""};switch(e){case"ms":o=s;break;case"s":o=v.ceil(s/1e3);break;case"m":o=v.ceil(s/1e3/60);break;case"h":o=v.ceil(s/1e3/3600);break;case"d":o=v.ceil(s/1e3/3600/24);break;default:throw new m("无法识别的参数 unit，只允许是以下值之一：ms、s、m、h、d。")}return o&&(l.value=o,l.unit=e),t.list.push(l),l}list(){return[...r.get(this).list]}reset(){let e=r.get(this);e.t0=0,e.list=[]}}}),I("API/Ajax",function(e,t,n){const r=e("Object"),i=e("String"),s=e("JSON"),o=e("Proxy"),l=e("Query");function a(e,t){let n=t.proxy;if(n)return o.request(n,t),null;let a=[t.url,t.prefix,t.name,t.ext].join(""),u=t.data||null;if(u){let e=t.serialize;u=r.map(u,function(t,n){return"object"==typeof n&&n?e(t,n):n})}if("post"==e){let e=t.query;e&&(a=l.add(a,e)),u&&(u=l.stringify(u))}else u&&(a=l.add(a,u),u=null);let c=t.random;c&&(c=i.random(4),a=l.add(a,c));let d=!1,h=null,p=t.timeout||0;p>0&&(h=f(function(){d=!0,g.abort();let e=t.ontimeout;e&&e(g)},p));let g=new XMLHttpRequest;g.open(e,a,!0),g.onreadystatechange=function(){if(d||4!=g.readyState)return;clearTimeout(h);let e=t.successCode,n=t.error,r=t.success,i=t.fail,o=t.field||null;if(200!=g.status)return void(n&&n(g));if(!o)return void(r&&r(g));let l=s.parse(g.responseText);if(!l)return void(n&&n(g));let a=l[o.code];if(a==e){let e=o.data in l?l[o.data]:{};r&&r(e,l,g)}else{let e=l[o.msg];i&&i(a,e,l,g)}};let m=t.headers;return m&&r.each(m,function(e,t){g.setRequestHeader(e,t)}),"post"==e&&g.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),g.send(u),g}t.exports={get:e=>a("get",e),post:e=>a("post",e)}}),I("API.defaults",function(e,t,n){t.exports={type:"json",successCode:200,field:{code:"code",msg:"msg",data:"data"},proxy:null,delay:!1,random:!0,url:"",prefix:"",ext:"",data:null,query:null,headers:null,timeout:0,serialize:function(e,t){let n=w.stringify(t);return encodeURIComponent(n)},get:null,post:null}}),I("API",function(e,t,n){const r=e("Object"),i=e("Emitter"),s=e("Fn"),o=t.require("Ajax"),l=new x;class a{constructor(e,t){"object"==typeof e&&(t=e,e=""),e=e||"",t=r.deepAssign({},n.defaults,t);let a=new i(this),u=t.successCode,c=t.proxy;switch(c){case!0:c=e+".js";break;case".json":case".js":c=e+c}let f={ajax:{name:e,data:t.data,query:t.query,url:t.url,prefix:t.prefix,ext:t.ext,random:t.random,successCode:u,field:t.field,proxy:c,serialize:t.serialize,timeout:t.timeout,headers:t.headers,success(e,t,n){d("success",[e,t,n])},fail(e,t,n,r){d("fail",[e,t,n,r])},error(e){f.aborted?f.aborted=!1:d("error",[e])},ontimeout(e){d("timeout",[e])}},status:"",args:[],emitter:a,xhr:null,aborted:!1,fireEvent:d,get:t.get||o.get,post:t.post||o.post};function d(e,n,r){e=f.status=e||f.status,n=f.args=n||f.args,r=r||f.emitter,f.xhr=null;let i=n.length,o=n[i-1],l=n[i-2],a="success"==e,c="fail"==e;s.delay(t.delay,function(){let t=r.fire("response",[e,l,o]);if(!t.includes(!1)){if(a||c){let e=a?u:n[0];if((t=r.fire("code",e,n)).includes(!1))return}o&&(t=r.fire("status",o.status,n)).includes(!1)||(t=r.fire(e,n)).includes(!1)||r.fire("done",[e,l,o])}})}l.set(this,f)}get(e){let t=l.get(this),n=t.emitter;t.aborted=!1;let r=j.assign({},t.ajax);e&&(r.data=e),e=r.data,n.fire("request","get",[e]),n.fire("request",["get",e]),t.xhr=t.get(r)}post(e,t){let n=l.get(this),r=n.emitter,i=n.ajax;n.aborted=!1;let s=j.assign({},i,{data:e||i.data,query:t||i.query});e=s.data,t=s.query,r.fire("request","post",[e,t]),r.fire("request",["post",e,t]),n.xhr=n.post(s)}abort(){let e=l.get(this),t=e.xhr;t&&(e.aborted=!0,t.abort(),e.emitter.fire("abort"))}on(...e){let t=l.get(this),n=t.emitter,r=t.status;if(n.on(...e),r){let n=new i(this);n.on.apply(n,e),t.fireEvent(r,t.args,n),n.destroy()}}destroy(){l.get(this).emitter.destroy(),l.delete(this)}}a.defaults=e("API.defaults"),t.exports=n=a}),I("Proxy/Url",function(e,t,n){const r=e("Url"),i=e("Query");t.exports={get:(e,t)=>(e=function(e,t){if(r.isFull(e))return e;if(r.isFull(t))return t+e;let n=r.root();return"/"!=e.slice(0,1)&&(n+=t),n+e}(e,t),e=i.random(e))}}),I("Proxy.defaults",function(e,t,n){t.exports={base:"",delay:{min:500,max:3e3}}}),I("Proxy",function(e,t,n){const r=e("Url"),i=e("JSON"),s=e("Fn"),o=e("Script"),l=t.require("Url");let a=null;function u(e,...t){let r=n.defaults.delay;s.delay(r,e,t)}function c(e,t){if(!e)return void u(t.error);let n=t.successCode,r=t.field,i=e[r.code];if(i==n){let n=e[r.data]||{};u(t.success,n,e)}else{let n=e[r.msg]||"";u(t.fail,i,n,e)}}t.exports=n={defaults:e("Proxy.defaults"),request(e,t){if(r.isExt(e,".js"))!function(e,t){let r=n.defaults.base,i=l.get(e,r);o.load(i,function(){let e=a;a=null,"function"==typeof e&&(e=e(t.data,t)),c(e,t)})}(e,t);else{if(!r.isExt(e,".json"))throw new m("不支持参数 file 的文件类型: "+e);!function(e,t){let r=n.defaults.base,s=l.get(e,r),o=new XMLHttpRequest;o.open("get",s,!0),o.onreadystatechange=function(){4==o.readyState&&(200==o.status?c(i.parse(o.responseText),t):u(t.error))},o.send(null)}(e,t)}},response(e){a=e}}}),I("Script.defaults",function(e,t,n){t.exports={url:"",id:"",charset:"utf-8",document:r.document,onload:null}}),I("Script",function(e,t,n){const r=e("Object");function i(e,t,n,r){let i;if("object"==typeof e){let s=e;i=s.id,e=s.url,t=s.charset,n=s.document,r=s.onload}let s=n.createElement("script");r&&(s.readyState?s.onreadystatechange=function(){let e=s.readyState;"loaded"!=e&&"complete"!=e||(s.onreadystatechange=null,r())}:s.onload=r),s.src=e,t&&(s.charset=t),i&&(s.id=i),n.head.appendChild(s)}t.exports=n={defaults:e("Script.defaults"),load(e){let t={...n.defaults};if(r.isPlain(e))j.assign(t,e);else{switch(t.url=e,typeof arguments[1]){case"string":t.charset=arguments[1];break;case"object":t.document=arguments[1];break;case"function":t.onload=arguments[1]}switch(typeof arguments[2]){case"object":t.document=arguments[2];break;case"function":t.onload=arguments[2]}arguments[3]&&(t.onload=arguments[3])}let s=t.url;if("string"==typeof s)i(t);else{if(!h.isArray(s))throw new m("参数 opt.url 必须为 string 或 string 的数组");!function(e,t,n,r){if(0==e.length)return void(r&&r());let s=0;!function o(){i(e[s],t,n,function(){++s<e.length?o():r&&r()})}()}(s,t.charset,t.document,t.onload)}}}}),I("Url.defaults",function(e,t,n){t.exports={root:()=>`${s.protocol}//${s.host}${s.pathname.split("/").slice(0,-1).join("/")}/`}}),I("Url",function(e,t,n){t.exports=n={defaults:e("Url.defaults"),root(){let e=n.defaults.root;return"function"==typeof e&&(e=e()),e.endsWith("/")||(e+="/"),e},main:e=>e=(e=e.split("#")[0]).split("?")[0],isFull:e=>"string"==typeof e&&(e.startsWith("http://")||e.startsWith("https://")),isExt:(e,t)=>"string"==typeof e&&"string"==typeof t&&(e=n.main(e)).slice(0-t.length).toLowerCase()==t.toLowerCase(),resolve(e){var t=arguments.length;if(0==t)throw new m("resolveUrl requires at least one argument; got none.");var n=i.createElement("base");if(n.href=e,1==t)return n.href;var r=i.head;r.insertBefore(n,r.firstChild);for(var s="",o=i.createElement("a"),l=1;l<t;l++)o.href=arguments[l],s=o.href,n.href=s;return r.removeChild(n),s}}}),I("App/Navigator/Views",function(e,t,n){const r=e("jquery"),i=e("Tasker"),s=e("Package"),o={};t.exports={load(e,t,n){let l=function(e){let t=[];return(h.isArray(e)?e:[e]).forEach((e,n)=>{e&&("string"==typeof e&&(e={view:e,args:[]}),t.push(e))}),t}(e),a=t.module,u=t.container,c=new i(l);c.on("each",function(e,t,n){let i=e.view,l=a.require(i);l?n(l):s.load(i,function(e){if(!e)throw new m(`总包中不存在名为 ${i} 的配置节点。`);let t=(e.html||{}).content;!o[i]&&u&&t&&(o[i]=!0,r(u).append(t));let s=a.require(i);if(!s)throw new m(`不存在名为 ${i} 的视图模块`);n(s)})}),c.on("all",function(e){n&&n(...e)}),c.parallel()}}}),I("App/Navigator",function(e,t,n){const r=e("Navigator"),i=t.require("Views");t.exports={create(e){let t=e.ViewSlider,n=e.animate,s=e.slide;if(n&&!t)throw new m("指定了参数 animate 为 true，必须提供 ViewSlider 以启用视图切换的动画效果（仅针对移动端）。");if(s&&!t)throw new m("指定了参数 slide 为 true，必须提供 ViewSlider 以启用滑动返回手势支持（仅针对移动端）。");let o=e.module,l=new r(e.id),a=()=>{l.back(!1)};return l.on("view",function(t,n,r){i.load(t,e,function(e){r.cache&&e.rendered()?e.show():e.render(...n)})}),e.preload&&l.on("immediate",function(n,r){let l=j.keys(r).map(function(e){return r[e]});l=l.sort(function(e,t){return e.timestamp>t.timestamp?-1:1}),i.load(l,e,function(){s&&l.slice(0,-1).forEach(function(e,n){let r=l[n+1],i=r.args;e=o.require(e.view),r=o.require(r.view),t.slide(e,r,{args:i,back:a})})})}),s&&l.on("to",function(n,r,s){n=o.require(n),i.load(r,e,function(e){t.slide(e,n,{back:a})})}),l.on("forward",function(r,s){r=o.require(r),i.load(s,e,function(e){n?t.forward(r,e):(r.hide(),e.show())})}),l.on("back",function(r,s){r=o.require(r),i.load(s,e,function(e){n?t.back(r,e):(r.hide(),e.show())})}),l}}}),I("App/Router",function(e,t,n){const r=e("Object"),i={};t.exports={set(e,t){if(i[e])throw new m(`重复定义的路由器: ${e}`);i[e]=t},bind(e,t,n){let s=r.map(i,function(i,s){return function(i){let o=s(e,t,n,i);r.isPlain(o)&&i.on(o)}});return t.bind(s),s}}}),I("App.defaults",function(e,t,n){t.exports={ViewSlider:null,root:"",name:"",seperator:"/",navigator:"app-default-navigator",view:{}}}),I("App",function(e,t,n){const r=e("SessionStorage"),i=e("LocalStorage"),s=e("AppModule"),o=t.require("Navigator"),l=t.require("Router");t.exports=n={defaults:e("App.defaults"),launch(e){const t=n.defaults,{name:a,root:u,seperator:c,navigator:f,view:d}=t;if(!a)throw new m("必须首先给应用分配一个唯一的名称，用于在存储中与其它应用区分开。");if("string"!=typeof u)throw new m("应用的顶级模块名称必须为一个 string。");if(u.includes(c))throw new m("应用的顶级模块名称不能含有父子模块的分隔符: "+c);r.defaults.name=a,i.defaults.name=a,j.assign(s.defaults,{seperator:c}),s.define(u,function(n,r,i){f&&(i=o.create({ViewSlider:t.ViewSlider,id:f,module:r,container:d.container,preload:d.preload,slide:d.slide,animate:d.animate})),l.bind(n,r,i),e&&e(n,r,i)}),s.require(u)},route:l.set}}),I("LocalStorage/Storage",function(e,t,n){const i=e("circular-json"),s=r.localStorage,o="@definejs/local-storage";let l=s.getItem(o)||"{}",a=i.parse(l)||{};function u(){l=i.stringify(a),s.setItem(o,l)}t.exports={set(e,t){a[e]=t,u()},get:e=>a[e],remove(e){delete a[e],u()},clear(){a={},u()}}}),I("LocalStorage.defaults",function(e,t,n){t.exports={name:""}}),I("LocalStorage",function(e,t,n){const r=e("Object"),i=t.require("Storage"),s=new x;class o{constructor(e,t){let i=(t=r.deepAssign({},n.defaults,t)).name;if(!i)throw new m("@definejs/local-storage 是针对多个应用的存储，每个应用都有自己独立的存储空间。\n                    请先指定所在应用的名称(通过配置 @definejs/local-storage.defaults 模块的 name 字段) 。");let o={name:i,id:e};s.set(this,o)}set(e,t){let n=s.get(this),r=i.get(n.name)||{},o=r[n.id]||{};"object"==typeof e?j.assign(o,e):o[e]=t,r[n.id]=o,i.set(n.name,r)}get(e){let t=s.get(this),n=(i.get(t.name)||{})[t.id];if(n)return 0==arguments.length?n:n[e]}remove(e){let t=s.get(this),n=i.get(t.name)||{},r=n[t.id];r&&(delete r[e],i.set(t.name,n))}clear(){let e=s.get(this),t=i.get(e.name);t&&(delete t[e.id],i.set(e.name,t))}}o.defaults=e("LocalStorage.defaults"),t.exports=n=o}),I("Navigator/Back",function(e,t,n){t.exports={getOffset(e,t){if(!t)return-1;let n=typeof t;if("number"==n){if(t<0)throw new m("要回退的步数(参数 target) 如果指定为数字时，只能是正数。");return 0-(t||1)}if("string"!=n)throw new m("要回退的目标视图(参数 target) 只能是 number 或 string 类型。");let r=e.hash$info[e.hash];if(!r)throw new m("当前视图为空，无法回退。");let i=e.this.get(),s=r.view,o=-1,l=-1;if(i.forEach(function(e,n){let r=e.view;r==t&&(o=n),r==s&&(l=n)}),o<0)throw new m(`历史记录中不存在名为 ${t} 的目标视图。`);let a=o-l;if(0==a)throw new m(`要回退到的目标视图 ${t} 即为当前视图。`);if(a>0)throw new m(`要回退到的目标视图 ${t} 在当前视图的后面，应该用前进。`);return a}}}),I("Navigator/Hash",function(e,t,n){const i=e("Hash");t.exports={init(e){let t=e.emitter;i.onchange(r,!0,function(n,r,i){if(e.hash=n,!e.enabled)return;if(!e.fireEvent)return void(e.fireEvent=!0);if(i&&t.fire("immediate",[n,e.hash$info]),!n)return r=e.router.toView(r),void t.fire("none",[r]);let s=e.hash$info[n],o=e.hash$info[r];if(s){let e=!0;if("cache"in s&&(e=s.cache,delete s.cache),t.fire("view",[s.view,s.args,{target:s,current:o,cache:e}]),o){let e=s.timestamp>o.timestamp?"forward":"back";t.fire(e,[o.view,s.view])}}else n=e.router.toView(n),r=e.router.toView(r),i?t.fire("start",[n,r]):t.fire("404",[n,r])})},set(e){i.set(r,e)}}}),I("Navigator/Infos",function(e,t,n){t.exports={set(e,t,n){let r=e.router.toHash(t),i=e.hash$info,s=e.storage,o=(new g).getTime(),l=i[r]={view:t,hash:r,timestamp:o,args:n||[]};return e.infos=function(e){let t=j.keys(e).map(function(t){return e[t]});return t=t.sort(function(e,t){return e.timestamp>t.timestamp?1:-1})}(i),s&&s.set("hash$info",i),l},get(e,t){let n=e.hash$info;if("string"==typeof t){return n[e.router.toHash(t)]}let r=t,i=e.infos;if("number"!=typeof r)return i;let s=n[e.hash];return i[i.findIndex(function(e){return e===s})+r]}}}),I("Navigator/Meta",function(e,t,n){const r={};t.exports={create:function(e,t){var n=e.id;if(!n)throw new m("创建 Navigator 实例时，必须指定 id 字段。");if(r[n])throw new m(`Navigator 已存在 id 为 ${n} 的实例。`);r[n]=!0;var i=t.storage,s=i&&i.get("hash$info")||{},o={id:n,hash:"",fireEvent:!0,rendered:!1,enabled:e.enabled,hash$info:s,infos:[],storage:null,emitter:null,router:null,this:null};return j.assign(o,t),o}}}),I("Navigator/Router",function(e,t,n){t.exports={create(){let e={view$hash:{},hash$view:{},view2hash:null,hash2view:null,toHash(t){let n=t;if(t in e.view$hash?n=e.view$hash[t]:"function"==typeof e.view2hash&&(n=e.view2hash(t)),"string"!=typeof(n=n||""))throw new m("自定义的 view -> hash 的转换关系中，hash 必须为 string 类型。");return n},toView(t){let n=t;if(t in e.hash$view?n=e.hash$view[t]:"function"==typeof e.hash2view&&(n=e.hash2view(t)),"string"!=typeof(n=n||""))throw new m("自定义的 hash -> view 的转换关系中，view 必须为 string 类型。");return n}};return e}}}),I("Navigator/Storage",function(e,t,n){t.exports={create(e){let t=e.Storage,n=e.id;return t?new t(n):null}}}),I("Navigator.defaults",function(e,t,n){const r=e("SessionStorage");t.exports={Storage:r,id:"",enabled:!0,repeated:!1,simulate:!1}}),I("Navigator",function(e,t,n){const r=e("String"),i=e("Emitter"),s=t.require("Back"),o=t.require("Meta"),l=t.require("Hash"),a=t.require("Infos"),u=t.require("Router"),f=t.require("Storage"),d=new x;function h(e,t){t="object"==typeof e?e:j.assign({id:e},t),t=j.assign({},n.defaults,t);let r=new i(this),s=u.create(),l=f.create(t),a=o.create(t,{emitter:r,router:s,storage:l,this:this});d.set(this,a),j.assign(this,{id:a.id}),t.simulate&&this.route(h.simulate)}h.prototype={constructor:h,id:"",render(){var e=d.get(this);this.enable(!0),e.rendered||l.init(e)},route(e){let t=d.get(this).router,n=e.view$hash,r=e.hash$view,i=e.toHash,s=e.toView;null===r?t.hash$view={}:j.assign(t.hash$view,r),null===n?t.view$hash={}:j.assign(t.view$hash,n),"function"==typeof i&&(t.view2hash=i),"function"==typeof s&&(t.hash2view=s)},to(e,...t){if("string"!=typeof e)throw new m("参数 name 必须为 string 类型。");let n=d.get(this),r=n.emitter,i=n.hash$info[n.hash],s=a.set(n,e,t);if(!n.enabled)return s;s.hash!=n.hash&&(n.fireEvent=!1,l.set(s.hash));let o=!1;return"cache"in s&&(o=s.cache,delete s.cache),i&&r.fire("to",[i.view,e,{cache:o,current:i,target:s}]),r.fire("view",[e,t,{cache:o,current:i,target:s}]),i&&r.fire("forward",[i.view,e]),s},back(e){switch(typeof e){case"boolean":e={fireEvent:e};break;case"number":case"string":e={target:e};break;default:e=e||{}}let t=d.get(this),n=s.getOffset(t,e.target),r=e.fireEvent,i=e.cache,o=this.get(n);return t.fireEvent=r===S||!!r,o&&"boolean"==typeof i&&(o.cache=i),c.go(n),o},get(e){let t=d.get(this);return a.get(t,e)},clear(){let e=d.get(this);e.storage&&e.storage.clear(),e.fireEvent=!1,e.hash$info={},l.set(""),e.fireEvent=!0},reserve(e){let t=d.get(this),n=t.router.toHash(e),r=t.hash$info[n];t.hash$info={[n]:r},t.storage&&t.storage.set("hash$info",t.hash$info)},enable(e){d.get(this).enabled=!!e},on(...e){d.get(this).emitter.on(...e)}},j.assign(h,{defaults:e("Navigator.defaults"),simulate:{toHash:e=>e?e=`/${e=(e=r.toHyphenate(e)).slice(1)}.html`:e,toView:e=>/^\/.+\.html$/.test(e)?(e=e.slice(1,-5),e=(e=r.toCamelCase(e))[0].toUpperCase()+e.slice(1)):e}}),t.exports=n=h}),I("SessionStorage/Storage",function(e,t,n){const i=e("circular-json"),s=r.sessionStorage,o="@definejs/session-storage";let l=s.getItem(o)||"{}",a=i.parse(l)||{};function u(){l=i.stringify(a),s.setItem(o,l)}t.exports={set(e,t){a[e]=t,u()},get:e=>a[e],remove(e){delete a[e],u()},clear(){a={},u()}}}),I("SessionStorage.defaults",function(e,t,n){t.exports={name:""}}),I("SessionStorage",function(e,t,n){const r=e("Object"),i=t.require("Storage"),s=new x;class o{constructor(e,t){let i=(t=r.deepAssign({},n.defaults,t)).name;if(!i)throw new m("@definejs/session-storage 是针对多个应用的存储，每个应用都有自己独立的存储空间。\n                    请先指定所在应用的名称(通过配置 @definejs/session-storage.defaults 模块的 name 字段) 。");let o={name:i,id:e};s.set(this,o)}set(e,t){let n=s.get(this),r=i.get(n.name)||{},o=r[n.id]||{};"object"==typeof e?j.assign(o,e):o[e]=t,r[n.id]=o,i.set(n.name,r)}get(e){let t=s.get(this),n=(i.get(t.name)||{})[t.id];if(n)return 0==arguments.length?n:n[e]}remove(e){let t=s.get(this),n=i.get(t.name)||{},r=n[t.id];r&&(delete r[e],i.set(t.name,n))}clear(){let e=s.get(this),t=i.get(e.name);t&&(delete t[e.id],i.set(e.name,t))}}o.defaults=e("SessionStorage.defaults"),t.exports=n=o}),I("Package/All",function(e,t,n){const r=e("Url"),i=e("Tasker"),s=e("API"),o=e("Query");let l=null;function a(e,t){let n=function(e){let t=r.root()+e.url,n=e.query;return"string"==typeof n&&(n=o.parse(n)),n&&(t=o.add(t,n)),e.random&&(t=o.random(t,4)),t}(e),i=new s({url:n,field:{}});i.on({response(e,n,r){l=n||{},t&&t(l)}}),i.get()}t.exports={load(e,t){l?t&&t(l):i.todo("@definejs/package.load-all.sid",t,function(t){a(e,function(e){t(function(t){t&&t(e)})})})}}}),I("Package/Loader",function(e,t,n){const r=e("API"),s=e("Script"),o=e("Tasker");var l={css(e,t){let n=i.createElement("link");n.onerror=function(){throw new m(`css 文件加载失败: ${e}`)},n.onload=function(){t&&t({url:e,content:""})},n.rel="stylesheet",n.href=e,i.head.appendChild(n)},html(e,t){let n=new r({url:e,random:!1,field:null});n.on({success(n){let r=n.responseText;t&&t({url:e,content:r})},error(e){throw new m("error: "+e.status)}}),n.get()},js(e,t){s.load(e,function(){t&&t({url:e,content:""})})},json(e,t){let n=new r({url:e,field:{}});n.on({response(e,n,r){all=n||{},t&&t(all)}}),n.get()}};t.exports={load(e,t){let n=j.keys(e),r=new o(n);r.on({each(t,n,r){let i=e[t],s=l[t];if(!s)throw new m(`不支持加载 ${t} 类型的文件。`);s(i,function(e){r({type:t,url:e.url,content:e.content})})},all(e){let n={cache:!1};e.forEach(function(e){n[e.type]=e}),t&&t(n)}}),r.parallel()}}}),I("Package.defaults",function(e,t,n){t.exports={url:"packages/all.json",random:!0,query:null,loading:null,begin(e){e&&e.show()},end(e){e&&e.hide()}}}),I("Package",function(e,t,n){const r=e("Tasker"),i=t.require("All"),s=t.require("Loader"),o={};t.exports=n={defaults:e("Package.defaults"),load(e,t){let l=n.defaults;if("function"==typeof e)return t=e,void i.load(l,t);let a=o[e];if(a||null===a)return void(t&&t(a));let c={done:t},f=`@definejs/package:${e}`;r.todo(f,c,function(t){!function(e,t,n){let{begin:r,end:o,loading:l}=t;r&&r(l),i.load(t,function(r){let i=r[e];if(!i)return u.warn(`总包  ${t.url} 中不存在名为 ${e} 的配置节点。`),o&&o(l),void(n&&n(null));s.load(i,function(e){o&&o(l),n&&n(e)})})}(e,l,function(n){o[e]=n?j.assign({},n,{cache:!0}):null,t(function(e){e.done(n)})})})}}}),I("HTMLParser",function(e,t,n){t.exports=function(){var e={},t={},n=/([a-z0-9_\:\-]*)\s*?=\s*?(['"]?)(.*?)\2\s+/gim,r=/(?:<(\/?)([a-zA-Z][a-zA-Z0-9\:]*)(?:\s([^>]*?))?((?:\s*\/)?)>|(<\!\-\-)([\s\S]*?)(\-\->)|(<\!\[CDATA\[)([\s\S]*?)(\]\]>))/gm;function s(){this.childNodes=[]}function o(){}function l(){s.call(this)}function a(){}function c(){}function f(){}return t.extend=function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e},t.inherit=function(e,n){var r=e.prototype;function i(){}i.prototype=n.prototype,e.prototype=new i,t.extend(e.prototype,r),e.prototype.constructor=e},t.selfClosingTags=["area","base","br","col","embed","frame","hr","img","input","keygen","link","meta","object","param","source"],t.getElementsByTagName=function(e,n){var r,i,s=[],o=0;if(n||(n="*"),n=n.toLowerCase(),e.childNodes)for(r=0;r<e.childNodes.length;r++)1!==(i=e.childNodes[r]).nodeType||"*"!==n&&i.nodeName!==n||(s[o++]=i),h.prototype.splice.apply(s,[s.length,0].concat(t.getElementsByTagName(i,n))),o=s.length;return s},t.splitAttrs=function(e){var t,r={};if(e)for(n.lastIndex=0,e=" "+(e||"")+" ";t=n.exec(e);)r[t[1]]=t[3];return r},t.ta=i.createElement("textarea"),t.encodeEntities=function(e){return t.ta.value=e||"",t.ta.innerHTML},t.decodeEntities=function(e){return t.ta.innerHTML=e||"",t.ta.value},t.htmlToText=function(e){return e=e.replace(/<\/?[a-z].*?>/gim,""),t.decodeEntities(e)},t.extend(s.prototype,{nodeType:1,textContent:"",getElementsByTagName:function(e){return t.getElementsByTagName(this,e)},getAttribute:function(e){if(this.attributes.hasOwnProperty(e))return this.attributes[e]},setAttribute:function(e,t){var n=(e+"").toLowerCase();this.attributes[e]=t+"","id"!==n&&"name"!==n||(this[n]=t),"class"===n&&(this.className=t)},getElementById:function(e){var t,n=this.getElementsByTagName("*");for(t=n.length;t--;)if(n[t].id===e)return n[t]},appendChild:function(e){e.parentNode&&e.parentNode.removeChild(e),this.childNodes.push(e)},insertBefore:function(e,t){e.parentNode&&e.parentNode.removeChild(e);for(var n=0;n<this.childNodes.length&&this.childNodes[n]!==t;n++);this.childNodes.splice(n,0,e)},removeChild:function(e){for(var t=this.childNodes.length;t--;)if(this.childNodes[t]===e){this.childNodes.splice(t,1);break}}}),e.HTMLElement=s,t.extend(o.prototype,{toString:function(){return this.textContent}}),t.inherit(l,s),t.extend(l.prototype,{nodeType:9,nodeName:"#document"}),e.Document=l,t.inherit(a,o),t.extend(a.prototype,{nodeType:3,nodeName:"#text"}),e.TextNode=a,t.inherit(c,o),t.extend(c.prototype,{nodeType:8,nodeName:"#comment"}),e.CommentNode=c,t.inherit(f,o),t.extend(f.prototype,{nodeType:4,nodeName:"#cdata-section"}),e.CDATASectionNode=f,t.blockConstructors={"\x3c!--":c,"<![CDATA[":f},e.parse=function(e){var n,i,o,c,f,d,h,p,g,m,y,w,x;for(n=[],r.lastIndex=0,o=i=new l,w=function(){o&&n.length>0&&(c=n[n.length-1],h=(c.documentPosition.closeTag||c.documentPosition.openTag).end,c.parentNode===o&&h&&h<x.documentPosition.openTag.start&&(d=e.substring(h,x.documentPosition.openTag.start))&&(d=t.decodeEntities(d),o.childNodes.push(t.extend(new a,{textContent:d,nodeValue:d,parentNode:o}))))};f=r.exec(e);)p=f[5]||f[8],g=f[6]||f[9],m=f[7]||f[10],"\x3c!--"===p||"<![CDATA["===p?(h=r.lastIndex-f[0].length,(y=t.blockConstructors[p])&&(x=t.extend(new y,{textContent:g,nodeValue:g,parentNode:o,documentPosition:{openTag:{start:h,end:h+p.length},closeTag:{start:r.lastIndex-m.length,end:r.lastIndex}}}),w(),n.push(x),x.parentNode.childNodes.push(x))):"/"!==f[1]?((x=t.extend(new s,{nodeName:(f[2]+"").toLowerCase(),attributes:t.splitAttrs(f[3]),parentNode:o,documentPosition:{openTag:{start:r.lastIndex-f[0].length,end:r.lastIndex}}})).className=x.attributes.class,x.id=x.attributes.id,x.name=x.attributes.name,w(),n.push(x),x.parentNode.childNodes.push(x),f[4]&&f[4].indexOf("/")>-1||t.selfClosingTags.includes(x.nodeName)?(x.documentPosition.closeTag=x.documentPosition.openTag,x.isSelfClosingTag=!0,x.innerHTML="",x.outerHTML=e.substring(x.documentPosition.openTag.start,x.documentPosition.closeTag.end)):o=x):(f[2]+"").toLowerCase()===o.nodeName?(o=(x=o).parentNode,delete x.isSelfClosingTag,x.documentPosition.closeTag={start:r.lastIndex-f[0].length,end:r.lastIndex},x.innerHTML=e.substring(x.documentPosition.openTag.end,x.documentPosition.closeTag.start),x.outerHTML=e.substring(x.documentPosition.openTag.start,x.documentPosition.closeTag.end),x.textContent=t.htmlToText(x.innerHTML)):(f[2]+"").toLowerCase()===n[n.length-1].nodeName&&!0===n[n.length-1].isSelfClosingTag?(x=n[n.length-1],u.warn("HTML Error: discarding dangling </"+f[2]+"> tag. Already closed via: "+x.outerHTML),delete x.isSelfClosing,x.documentPosition.closeTag={start:r.lastIndex-f[0].length,end:r.lastIndex}):u.warn('tag mismatch: "'+f[2]+'" vs "'+x.nodeName+'"',x);return i.documentElement=i.getElementsByTagName("html")[0],i.body=i.getElementsByTagName("body")[0],i},e}()}),I("Template/Parser/Templates",function(e,t,n){t.exports={get(e){let t=e.getElementsByTagName("template"),n=new x;return t.map(function(e){let t=e.attributes,r=e.innerHTML,i={id:e.id||"",name:e.name||"",placeholder:t.placeholder||"",innerHTML:r,outerHTML:e.outerHTML,node:e,sample:r,parent:null,attributes:t,items:[]};return n.set(e,i),i}).filter(function(e){let t=function(e){for(e=e.parentNode;e;){if("template"==e.nodeName)return e;e=e.parentNode}return null}(e.node),r=n.get(t);if(!r)return!0;e.parent=r,r.items.push(e);let i=r.sample,s=e.outerHTML,o=e.placeholder;o&&(o="{"+o+"}"),r.sample=i.replace(s,o)})}}}),I("Template/Child",function(e,t,n){t.exports={create(e,t,n){let r=n.name;if(t.name$tpl[r])throw new m("同一级下已存在名为 `"+r+"` 的模板。");let i=new e(n);return t.name$tpl[r]=i,t.parent=t.this,i.parent=t.this,i.on("process",function(...e){t.emitter.fire("process",e)}),i}}}),I("Template/Meta",function(e,t,n){const r=e("String");function i(e){return e}t.exports={create(e){let t={id:r.randomId("definejs-template-",4),sample:"",name:"",placeholder:"",innerHTML:"",outerHTML:"",tpls:[],name$tpl:{},node:null,parent:null,emitter:null,this:null,process:i};return j.assign(t,e),t},assign(e,t){j.assign(e,{sample:t.sample,name:t.name,placeholder:t.placeholder,innerHTML:t.innerHTML,outerHTML:t.outerHTML,node:t.node})}}}),I("Template/Parser",function(e,t,n){const r=e("HTMLParser"),i=t.require("Templates");t.exports={parse(e){let t=r.parse(e);return{dom:t,tpls:i.get(t)}}}}),I("Template/Sample",function(e,t,n){const r=e("String"),i={begin:'<script type="text/template">',end:"<\/script>"},s={begin:"\x3c!--",end:"--\x3e"};t.exports=n={replace(e,t){let{outerHTML:r,placeholder:i}=t;return i&&(i="{"+i+"}"),e=(e=n.removeScript(e)).replace(r,i)},betweenComment(e){let{begin:t,end:n}=s;return e.includes(t)&&e.includes(n)&&(e=r.between(e,t,n)),e},removeScript(e){let{begin:t,end:n}=i;return e.includes(t)&&e.includes(n)&&(e=(e=e.split(t).join("")).split(n).join("")),e}}}),I("Template",function(e,t,n){const r=e("jquery"),i=e("String"),s=e("Object"),o=e("Emitter"),l=e("HTMLParser"),a=t.require("Meta"),c=t.require("Parser"),f=t.require("Sample"),d=t.require("Child"),p=new x;class g{constructor(e){let t=s.isPlain(e),n=a.create({emitter:new o(this),this:this});if(p.set(this,n),t){let t=e;a.assign(n,t),n.tpls=t.items.map(function(e){return d.create(g,n,e)})}else{let t=r(e).get(0);if(!t)throw e=e instanceof r?e.selector:e,new m("不存在模板节点: "+e);let i="template"==t.nodeName.toLowerCase(),s=f.removeScript(t.innerHTML),o=c.parse(s);n.sample=f.betweenComment(s),n.name=i?t.getAttribute("name"):"",n.placeholder=i?t.getAttribute("placeholder"):"",n.innerHTML=s,n.outerHTML=t.outerHTML,n.node=t,n.tpls=o.tpls.map(function(e){let t=d.create(g,n,e),r=n.sample;return n.sample=f.replace(r,e),t})}!function(){let e=n.name$tpl[""];if(!e)return;let t=p.get(e);if(j.keys(t.name$tpl).length>0)throw new m("无名称的 template 标签下不能再嵌套子级 template。");if(t.placeholder)throw new m("无名称的 template 标签不能设置 placeholder 属性。");n.sample=t.sample}(),j.assign(this,{id:n.id,_meta:n})}template(e){h.isArray(e)||(e=[...arguments]);let t=this,n=p.get(t);return e.map(function(e){t=n.name$tpl[e],n=p.get(t)}),t}sample(...e){let t=this.template(...e),n=p.get(t);if(!n)throw new m(`当前实例下不存在名称路径为 ${e.join(" ")} 的 Template 子实例。`);return n.sample}render(e,t){t&&this.process(t);let n=p.get(this).node,r=this.fill(e);return n&&(n.innerHTML=r),r}fill(e,...t){let n=[...arguments],r=n.findIndex(function(e){return h.isArray(e)||s.isPlain(e)});if(r<0)throw new m("填充模板时必须指定数据为一个数组或纯对象。");if(r>0){let e=n.slice(0,r),t=this.template(...e);if(!t)throw new m(`不存在路径为 ${e.join(".")} 的模板节点，请检查 html 模板树。`);let i=n.slice(r);return t.fill(...i)}let o=p.get(this);if(!h.isArray(e)){if(o.emitter.fire("process",n),"string"==typeof(e=o.process.apply(o.this,n)))return e;return i.format(o.sample,e)}return e.map(function(e,n){let r=[e,n,...t];o.emitter.fire("process",r);let s=o.process.apply(o.this,r);return"string"==typeof s?s:s?i.format(o.sample,s):""}).join("")}process(e){let t=p.get(this);if("function"==typeof e)return void(t.process=e);let n=[...arguments],r=n.findIndex(function(e){return"function"==typeof e||s.isPlain(e)});if(r<0)throw new m(`模板节点 ${t.name} 缺少处理器。`);if(r>0){let t=n.slice(0,r),i=n[r];e=s.make({},t,i)}s.flat(e).forEach(function(e){let n=e.keys.filter(function(e){return!!e}),r=e.value;if("function"!=typeof r)throw new m(`模板节点 ${n.join(".")} 的处理器必须为一个函数。`);let i=t.this.template(n);i?i.process(r):u.warn(`不存在模板节点: ${n.join(".")}`)})}fix(e){let t=p.get(this),n=t.sample;(e=h.isArray(e)?e:[e]).map(function(e){let t="{"+e+"}",r=t+'=""';n=n.split(r).join(t)}),t.sample=n}on(...e){p.get(this).emitter.on(...e)}destroy(){let e=p.get(this);e&&(e.tpls.map(function(e){e.destroy()}),e.emitter.destroy(),e.node=null,e.parent=null,e.emitter=null,p.delete(this))}static create(e){e=`<template>${e}</template>`;let t=l.parse(e);return new g(t.childNodes[0])}}t.exports=g}),I("Alert/Dialog/Height",function(e,t,n){const r=e("String");t.exports={get(e){let t=function(e){e=C(e);let t=r.getByteLength(e),n=v.max(t,125);return n>=.8*i.documentElement.clientHeight&&(n="80%"),n}(e),n=function(e){let t=25*(e=C(e)).split("\n").length+60;return t>=.8*i.documentElement.clientHeight&&(t="80%"),t}(e),s=v.max(t,n);return"number"==typeof s&&(s=s%2==1?s+1:s),s}}}),I("Alert/Dialog",function(e,t,n){const r=t.require("Height");let s=null,o=!1,l=[],a=null,u=13,c=null;function f(e,t){let n=r.get(e);(s=s||function(){let e=j.assign({},c),t=new(0,e.Dialog)({cssClass:"definejs-alert",volatile:e.volatile,mask:e.mask,autoClose:e.autoClose,width:e.width,"z-index":e["z-index"],buttons:e.buttons});return t.on("button",{ok(){let e=t.data("fn");e&&e()}}),t.on({show(){o=!0,u=13==u?"enter":"",(a=i.activeElement).blur()},hide(){o=!1;let e=l.shift();e&&f(e.text,e.fn),a=null,u=""}}),i.addEventListener("keydown",e=>{u=e.keyCode}),i.addEventListener("keyup",e=>{if(13!=e.keyCode||!o||"enter"==u)return;t.hide();let n=t.data("fn");n&&n()}),t}()).data("fn",t),s.set({content:e,height:n}),s.show()}t.exports={init(e){c=e},add(e,t){o?l.push({text:e,fn:t}):f(e,t)}}}),I("Alert/Sample",function(e,t,n){t.exports='<pre class="JSON">{text}</pre>'}),I("Alert.defaults",function(e,t,n){const r=e("Dialog");t.exports={Dialog:r,volatile:!1,mask:!0,autoClose:!0,width:450,"z-index":99999,buttons:[{text:"确定",cmd:"ok",cssClass:"OK"}]}}),I("Alert",function(e,t,n){const r=e("String"),i=t.require("Dialog"),s=t.require("Sample");t.exports=n={defaults:e("Alert.defaults"),show(e,t,o,l){"object"==typeof e&&(e=w.stringify(e,null,4),e=r.format(s,{text:e}));let a=[...arguments],u=a.findIndex(function(e,t){return"function"==typeof e});u>0?(l=a[u],a=a.slice(0,u)):l=null,e=r.format(...a),i.init(n.defaults),i.add(e,l)}}}),I("Dialog/Template/Sample",function(e,t,n){t.exports='\n    <div id="{id}" class="definejs-dialog {cssClass}" style="{style} display: none;">\n        <template name="header" placeholder="header">\n            <header id="{headerId}">\n                {title}\n            </header>\n        </template>\n    \n        <template name="content" placeholder="content">\n            <article id="{articleId}" class="{noHeader} {noFooter}">\n                <div id="{contentId}">{content}</div>\n            </article>\n        </template>\n    \n        <template name="footer" placeholder="footer">\n            <footer id="{footerId}" class="Buttons-{count}">\n                <template name="button" placeholder="buttons">\n                    <button data-index="{index}" class="{cssClass}" style="{style}">{text}</button>\n                </template>\n            </footer>\n        </template>\n    </div>\n    '}),I("Dialog/Events",function(e,t,n){const r=e("jquery");t.exports={bind(e){e.masker&&e.volatile&&e.masker.on({show(){},hide(){e.this.hide()}}),function(){if(!e.buttons.length)return;let t=e.$footer,n=e.eventName,i="button[data-index]",s=e.pressedClass;function o(t){let n=+this.getAttribute("data-index"),r=e.buttons[n],i=r.cmd||C(n),s=r.fn;s&&s(r,n),e.emitter.fire("button",i,[r,n]),e.emitter.fire("button",[r,n]);let o=r.autoClose;o===S&&(o=e.autoClose),o&&e.this.hide()}"touch"!=n?(t.on(n,i,o),t.on("mousedown",i,function(e){r(this).addClass(s)}),t.on("mouseup mouseout",i,function(e){r(this).removeClass(s)})):t.touch(i,o,s)}()}}}),I("Dialog/Masker",function(e,t,n){t.exports={create(e){let t=e.Masker,n={container:e.container},r=t.normalize(n,e.mask);return r?(j.assign(r,{volatile:e.volatile,"z-index":e["z-index"]-1}),new t(r)):null}}}),I("Dialog/Meta",function(e,t,n){const r=e("String"),i="definejs-dialog-";t.exports={create(e,t){let n=r.randomId(i,4),s=e.buttons||[];s=s.map(function(e){return"string"==e?{text:e}:e});let o={id:n,headerId:r.randomId(i,"header-",4),articleId:r.randomId(i,"article-",4),contentId:r.randomId(i,"content-",4),footerId:r.randomId(i,"footer-",4),Masker:e.Masker,Scroller:e.Scroller,scrollable:e.scrollable,scrollerConfig:e.scroller,eventName:e.eventName,title:e.title,content:e.content,buttons:s,"z-index":e["z-index"],width:e.width,height:e.height,autoClose:e.autoClose,volatile:e.volatile,cssClass:e.cssClass||"",container:e.container,pressedClass:"Pressed",visible:!1,style:{},data:{},scroller:null,masker:null,emitter:null,this:null,$:null,$header:null,$content:null,$footer:null};return j.assign(o,t),o}}}),I("Dialog/Style",function(e,t,n){const r=e("Object"),i=e("Style");t.exports={get(e){let t=r.filter(e,["height","width","z-index"]),n=i.objectify(e.style);return n=i.merge(n,t),n=i.pixelize(n,["height","width"])}}}),I("Dialog/Template",function(e,t,n){const r=e("Template"),i=e("Style"),s=t.require("Sample"),o=r.create(s);o.process({"":function(e){let t=this.fill("header",e),n=this.fill("content",e),r=this.fill("footer",e),s=i.stringify(e.style);return{id:e.id,cssClass:e.cssClass||"",style:s,header:t,content:n,footer:r}},header:function(e){let t=e.title;return t?{headerId:e.headerId,title:t}:""},content:function(e){return{articleId:e.articleId,contentId:e.contentId,content:e.content,noHeader:e.title?"":"NoHeader",noFooter:e.buttons.length>0?"":"NoFooter"}},footer:{"":function(e){let t=e.buttons,n=t.length;return n?(t=this.fill("button",t),{footerId:e.footerId,count:n,buttons:t}):""},button:function(e,t){let n=i.stringify(e.style);return{index:t,text:e.text,cssClass:e.cssClass||"",style:n}}}}),t.exports=o}),I("Dialog.defaults",function(e,t,n){const r=e("Masker");t.exports={Masker:r,Scroller:null,container:"body",mask:!0,autoClose:!0,volatile:!1,title:"",content:"",eventName:"click",cssClass:"","z-index":1024,width:600,height:"50%",style:{},buttons:[],scrollable:!1,scroller:null}}),I("Dialog",function(e,t,n){const r=e("jquery"),i=e("Object"),s=e("Emitter"),o=t.require("Style"),l=t.require("Meta"),a=t.require("Masker"),u=t.require("Events"),c=t.require("Template"),f=new x;class d{constructor(e){e=i.deepAssign({},n.defaults,e);let t=new s(this),r=o.get(e),u=a.create(e),c=l.create(e,{style:r,emitter:t,masker:u,this:this});f.set(this,c),j.assign(this,{id:c.id})}render(){let e=f.get(this);if(e.$)return;let t=c.fill(e);if(r(e.container).append(t),e.$=this.$=r(`#${e.id}`),e.$header=r(`#${e.headerId}`),e.$article=r(`#${e.articleId}`),e.$content=r(`#${e.contentId}`),e.$footer=r(`#${e.footerId}`),e.scrollable){let t=e.Scroller;if(!t)throw new m("你已指定了内容区域可滚动，请传入滚动器模块对应的构造函数 Scroller。");e.scroller=new t(e.$article,e.scrollerConfig),e.scroller.render()}u.bind(e),e.emitter.fire("render")}show(){let e=f.get(this);e.visible?e.scroller&&e.scroller.refresh(200):(e.$||this.render(),e.$.show(),e.visible=!0,e.masker&&e.masker.show(),e.scroller&&e.scroller.refresh(200),e.emitter.fire("show"))}hide(){let e=f.get(this);e.$&&e.visible&&(e.$.hide(),e.visible=!1,e.masker&&e.masker.hide(),e.emitter.fire("hide"))}remove(){let e=f.get(this);if(!e.$)return;e.masker&&e.masker.remove(),e.layer&&e.layer.remove();let t=e.$.get(0);t.parentNode.removeChild(t),e.$.off(),e.visible=!1,e.masker=null,e.layer=null,e.$=null,e.$header=null,e.$content=null,e.$footer=null,e.emitter.fire("remove")}on(...e){f.get(this).emitter.on(...e)}destroy(){let e=f.get(this);if(!e)throw new m("该实例已给销毁，无法再次调用 destroy 方法。");this.remove(),e.emitter.destroy(),e.scroller&&e.scroller.destroy(),f.delete(this)}set(e,n){this.render();let r=f.get(this),s=r.scroller,l="object"==typeof e?e:{[e]:n};i.each(l,function(e,n){switch(e){case"title":r.$header.html(n);break;case"content":r.$content.html(n),s&&s.refresh(200);break;case"height":case"width":let i={};i[e]=r[e]=n,i=o.get(i),j.assign(r.style,i),r.$.css(i),s&&s.refresh(300);break;default:throw new m(`${t.id} 目前不支持设置属性: ${e}`)}})}data(e,t){let n=f.get(this).data,r=arguments.length;return 0==r?n:i.isPlain(e)?(j.assign(n,e),e):1==r?n[e]:(n[e]=t,t)}}d.defaults=e("Dialog.defaults"),t.exports=n=d}),I("Masker/Meta",function(e,t,n){const r=e("String");t.exports={create(e,t){let n=r.randomId("definejs-masker-",4),i=e.eventName,s=e.volatile,o={id:n,sample:"",eventName:i,volatile:s,container:e.container,duration:e.duration,fadeIn:e.fadeIn,fadeOut:e.fadeOut,opacity:e.opacity,emitter:null,style:null,this:null,$:null,bindVolatile(e){s&&("touch"==i?o.$.touch(e):o.$.on(i,e))}};return j.assign(o,t),o}}}),I("Masker/Sample",function(e,t,n){t.exports='<div id="{id}" class="definejs-masker" style="{style} display: none;"></div>'}),I("Masker/Style",function(e,t,n){const r=e("Object"),i=e("Style");t.exports={get(e){let t=r.filter(e,["opacity","z-index"]),n=i.objectify(e.style);return n=i.merge(n,t)}}}),I("Masker.defaults",function(e,t,n){t.exports={volatile:!1,container:"body",eventName:"click",duration:0,fadeIn:0,fadeOut:0,cssClass:"",opacity:.5,"z-index":1024,style:{}}}),I("Masker",function(e,t,n){const r=e("jquery"),i=e("Emitter"),s=e("Object"),o=e("String"),l=e("Style"),a=t.require("Sample"),u=t.require("Style"),c=t.require("Meta"),d=new x;class h{constructor(e){e=s.deepAssign({},n.defaults,e);let t=new i(this),r=u.get(e),o=c.create(e,{sample:a,style:r,emitter:t,this:this});d.set(this,o),j.assign(this,{id:o.id})}render(){let e=d.get(this);if(e.$)return;let t=l.stringify(e.style),n=o.format(e.sample,{id:e.id,style:t});r(e.container).append(n),this.$=e.$=r(`#${e.id}`),e.bindVolatile(function(){if(!1===e.this.hide())return;let t=e.$.css("opacity");e.$.css("opacity",0),e.this.show({quiet:!0}),f(function(){e.$.css("opacity",t),e.$.hide()},200)}),e.emitter.fire("render")}show(e){e=e||{};let t=d.get(this),n="duration"in e?e.duration:t.duration,r="fadeIn"in e?e.fadeIn:t.fadeIn;t.$||this.render(),n&&f(function(){t.this.hide()},n),r&&t.$.css("opacity",0),t.$.show(),r&&t.$.animate({opacity:t.opacity},r),e.quiet||t.emitter.fire("show")}hide(e){e=e||{};let t=d.get(this),n="fadeOut"in e?e.fadeOut:t.fadeOut;if(t.$)return!t.emitter.fire("hide").includes(!1)&&void(n?t.$.animate({opacity:0},n,function(){t.$.css("opacity",t.opacity),t.$.hide()}):t.$.hide())}remove(){let e=d.get(this);if(!e.$)return;let t=e.$.get(0);t.parentNode.removeChild(t),e.$.off(),this.$=e.$=null,e.emitter.fire("remove")}on(...e){d.get(this).emitter.on(...e)}destroy(){let e=d.get(this);this.remove(),e.emitter.destroy(),d.delete(this)}static normalize(e,t){if(!1===t)return null;"number"==typeof e&&(e={opacity:e}),"number"==typeof t&&(t={opacity:t});let n=typeof e,r=typeof t;return"object"==n&&"object"==r?j.assign({},e,t):!0===t?e&&"object"==n?e:{}:t===S?"object"==n?e:e?{}:null:"object"==r?t:t?{}:null}}h.defaults=e("Masker.defaults"),t.exports=n=h}),I("Confirm.defaults",function(e,t,n){const r=e("Dialog");t.exports={Dialog:r,mask:!0,height:140,autoClose:!0,volatile:!1,"z-index":99999,buttons:[{text:"确定",cmd:"ok",cssClass:"OK"},{text:"取消",cmd:"cancel",cssClass:"Cancel"}]}}),I("Confirm",function(e,t,n){let r=null,s=!1,o=[],l=null,a=13;function u(e){(r=r||function(){let e=n.defaults,t=new(0,e.Dialog)({cssClass:"definejs-confirm",volatile:e.volatile,mask:e.mask,autoClose:e.autoClose,height:e.height,"z-index":e["z-index"],buttons:e.buttons});return t.on("button",{ok(){let e=t.data("ok");e&&e()},cancel(){let e=t.data("cancel");e&&e()}}),t.on({show(){s=!0,a=13==a?"enter":"",(l=i.activeElement).blur(),t.$.find("footer button").get(0).focus()},hide(){s=!1;let e=o.shift();e&&u(e),l&&l.focus(),l=null,a=""}}),i.addEventListener("keydown",e=>{a=e.keyCode}),i.addEventListener("keyup",e=>{if(13!=e.keyCode||!s||"enter"==a)return;t.hide();let n=t.data("ok");n&&n()}),t}()).data(e),r.set({content:e.text}),r.show();let t=e.buttons||[];n.defaults.buttons.forEach(function(e,n){let i=r.$.find(`button[data-index="${n}"]`),s=t[n]||e.text;i.html(s)})}t.exports=n={defaults:e("Confirm.defaults"),show(e,t){let n="object"==typeof e?e:{text:e,ok:t};s?o.push(n):u(n)}}}),I("Loading/Masker",function(e,t,n){const r=e("Masker");t.exports={create(e){let t={container:e.container},n=r.normalize(t,e.mask);if(!n)return null;let i=new r(n),s=e["z-index"]-1;return i.on("render",function(){i.$.css({"z-index":s})}),i}}}),I("Loading/Meta",function(e,t,n){const r=e("String");t.exports={create(e,t){let n={id:r.randomId("definejs-loading-",4),textId:r.randomId("definejs-loading-","text-",4),text:e.text||"",cssClass:e.cssClass||"",container:e.container,duration:e.duration||0,sample:"",masker:null,style:null,emitter:null,this:null,$:null,$text:null};return j.assign(n,t),n}}}),I("Loading/Presettings",function(e,t,n){t.exports={fullscreen:{cssClass:"FullScreen"},"scroller.pulldown":{sample:"IOS",cssClass:"SameLine Pulldown",text:"加载中..."},"scroller.pullup":{sample:"IOS",cssClass:"SameLine Pullup",text:"加载中..."}}}),I("Loading/Sample",function(e,t,n){const r={IOS:'\n            <div id="{id}" class="definejs-loading-ios {cssClass}" >\n                <div class="Main">\n                    <div class="Item-0"></div>\n                    <div class="Item-1"></div>\n                    <div class="Item-2"></div>\n                    <div class="Item-3"></div>\n                    <div class="Item-4"></div>\n                    <div class="Item-5"></div>\n                    <div class="Item-6"></div>\n                    <div class="Item-7"></div>\n                    <div class="Item-8"></div>\n                    <div class="Item-9"></div>\n                    <div class="Item-10"></div>\n                    <div class="Item-11"></div>\n                </div>\n                <span id="{textId}" class="Text">{text}</span>\n            </div>\n        '};t.exports={get:function(e){return r[e]||""}}}),I("Loading/Style",function(e,t,n){const r=e("Object"),i=e("Style");t.exports={get(e){let t=r.filter(e,["height","width","z-index"]),n=i.objectify(e.style);return n=i.merge(n,t),n=i.pixelize(n,["height","width"])}}}),I("Loading.defaults",function(e,t,n){t.exports={text:"处理中...",mask:!1,sample:"IOS",container:"body",duration:0,cssClass:"","z-index":1024,width:"",height:"",style:{}}}),I("Loading",function(e,t,n){const r=e("jquery"),i=e("Object"),s=e("String"),o=e("Emitter"),l=t.require("Sample"),a=t.require("Style"),u=t.require("Meta"),c=t.require("Masker"),d=t.require("Presettings"),h=new x;class p{constructor(e={}){let t=d[e.presetting]||{},r=i.deepAssign({},n.defaults,t,e),s=new o(this),f=l.get(r.sample),p=a.get(r),g=c.create(r),m=u.create(r,{sample:f,style:p,emitter:s,masker:g,this:this});h.set(this,m),j.assign(this,{id:m.id})}render(){let e=h.get(this);if(e.$)return;let t=s.format(e.sample,{id:e.id,text:e.text,textId:e.textId,cssClass:e.cssClass});r(e.container).append(t),e.$=this.$=r(`#${e.id}`),e.$text=r(`#${e.textId}`),e.$.css(e.style),e.emitter.fire("render")}show(e,t){"function"==typeof e&&(t=e,e=S);let n=h.get(this),r=n.masker,i=n.duration;n.$||this.render(),r&&r.show(),"string"==typeof e&&(n.text=e,n.$text.html(e)),i&&f(function(){n.this.hide(),t&&t()},i),n.$.toggleClass("NoText",!n.text),n.$.show(),n.emitter.fire("show")}hide(){let e=h.get(this),t=e.masker;e.$&&(t&&t.hide(),e.$.hide(),e.emitter.fire("hide"))}remove(){let e=h.get(this);if(!e.$)return;let t=e.$.get(0),n=e.masker;t.parentNode.removeChild(t),n&&n.remove(),e.$.off(),e.$=this.$=null,e.$text=null,e.masker=null,e.emitter.fire("remove")}on(...e){h.get(this).emitter.on(...e)}destroy(){let e=h.get(this);this.remove(),e.emitter.destroy(),h.remove(this)}}p.defaults=e("Loading.defaults"),t.exports=n=p}),I("Panel/Container",function(e,t,n){const r=e("String");t.exports={get:(e,t)=>r.format(t.container,{id:e}),set(e,t){if(!(t=t||e.$.selector)&&e.module&&(t=e.container),!t)throw new m("设置 container 时，请给参数 value 提供一个有效的值。");e.container=t,e.$.off(),e.$=e.this.$=$(e.container),e.panel&&(e.panel.$=e.$);let n=e.$.find.bind(e.$);e.$.find=function(...e){let t=n(...e);return t.each(function(e){let t=this;i.documentElement.contains(t)||t.parentNode.removeChild(t)}),t=n(...e)}}}}),I("Panel/Meta",function(e,t,n){const r=e("String");t.exports={create(e,t){const n={id:r.randomId("defnejs-panel-",4),container:"",rendered:!1,renderArgs:[],show:e.show,visible:!1,tplContainer:null,module:null,$:null,$emitter:null,emitter:null,tpl:null,panel:null,this:null};return j.assign(n,t),n}}}),I("Panel/Params",function(e,t,n){var r=e("String"),i=e("Object");t.exports={normalize(e,t,n){let s=typeof e;if("object"==s)return e;if("string"!=s)throw new m("无法识别参数 name 的类型。");if("object"==(s=typeof t)||"function"==s)return{[e]:t};if("string"!=s)throw new m("无法识别参数 sample 的类型。");if("function"==(s=typeof n))return{[e]:{[t]:n}};if("object"==s){let s={};return i.each(n,function(e,n){e=r.format(t,{value:e}),s[e]=n}),{[e]:s}}throw new m("无法识别参数 selector$fn 的类型。")}}}),I("Panel.defaults",function(e,t,n){t.exports={container:'[data-panel="{id}"]',show:!0}}),I("Panel",function(e,t,n){const r=e("jquery"),i=e("Object"),s=e("Emitter"),o=e("Template"),l=e("AppModule"),a=t.require("Container"),c=t.require("Meta"),f=t.require("Params"),d=new x,p={};function g(e,t){t=i.deepAssign({},n.defaults,t);const o=c.create(t,{moudle:null,container:e,tplContainer:e,$emitter:new s,emitter:new s(this),$:r(e),this:this});d.set(this,o),j.assign(this,{container:e,id:o.id,$:o.$})}j.assign(g.prototype,{container:"",id:"",$:null,module:null,render(...e){let t=d.get(this),n=t.emitter;t.renderArgs=e,t.rendered||(t.rendered=!0,n.fire("init")),n.fire("before-render",e),n.fire("render",e),t.show&&this.show(),n.fire("after-render",e)},show(...e){let t=d.get(this);return t.$.show(...e),t.visible=!0,t.emitter.fire("show")},hide(...e){let t=d.get(this);return t.$.hide(...e),t.visible=!1,t.emitter.fire("hide")},toggle(e){let t=d.get(this);return 0==arguments.length?t.visible?this.hide():this.show():e?this.show():this.hide(),t.visible},template(e){let t=d.get(this),n=t.tpl;return n||(n=t.tpl=new o(t.tplContainer)),e&&n.process(...arguments),n},fill(e,t){let n=d.get(this);return this.template(),n.tpl.render(e,t),n.emitter.fire("fill",[e])},refresh(){let e=d.get(this),t=e.renderArgs;return this.render(...t),e.emitter.fire("refresh",t)},reset(...e){return d.get(this).emitter.fire("reset",e)},close(...e){return d.get(this).emitter.fire("close",e)},visible(){return d.get(this).visible},rendered(){return d.get(this).rendered},fire(...e){return d.get(this).$emitter.fire(...e)},$on(e,t,n){let r=f.normalize(e,t,n);if(!r)return;let s=d.get(this);i.each(r,function(e,t){t&&("function"!=typeof t?i.each(t,function(t,n){s.$.on(e,t,n)}):s.$.on(e,t))})},$bind(e,t){let n=null;if("string"==typeof e)n={[e]:t};else{if("object"!=typeof e)throw new m("无法识别参数 selector 的类型。");n=e}if(!n)return;let r=d.get(this);i.each(n,function(e,t){t&&i.each(t,function(t,n){r.$.on(t,e,n)})})},wrap(e){let t=d.get(this),n=t.panel;if(n)return n;e=e||{},n=t.panel={};let r=new Set([...Reflect.ownKeys(t.this),...Reflect.ownKeys(g.prototype)]);r.delete("constructor"),r.delete("fire"),r.delete("wrap"),(r=[...r]).forEach(e=>{let r=t.this[e];"function"==typeof r&&(r=r.bind(t.this)),n[e]=r});let i=t.$emitter;return j.assign(n,e,{on:i.on.bind(i),off:i.off.bind(i)}),n},propagate(e,t){let n=d.get(this);t.forEach(function(t){e.on(t,function(...e){n.this.fire(t,e)})})},set(e,t){var n=d.get(this);if(i.isPlain(e))i.each(e,function(e,t){n.this.set(e,t)});else switch(e){case"show":case"rendered":n[e]=t;break;case"$":case"container":a.set(n,t);break;case"visible":n.visible=!!t;break;case"template":if(n.tpl)throw new m("当前实例中已创建了模板实例，无法再修改模板实例所关联的 DOM 容器。");n.tplContainer=n.$.find(t);break;default:throw new m(`目前不支持设置属性: ${e}`)}},destroy(){let e=d.get(this);e.emitter.destroy(),e.$emitter.destroy(),e.$.off(),d.delete(this)},on(...e){d.get(this).emitter.on(...e)}}),j.assign(g,{defaults:e("Panel.defaults"),define(e,t,r){r=r||{constructor:g,defaults:n.defaults},l.define(e,function(n,i,s){e=i.id;let o=a.get(e,r.defaults),l=new r.constructor(o);return d.get(l).module=l.module=i,s=t(n,i,l),s=l.wrap(s),p[e]=l,s})},update(e,t){e=h.isArray(e)?e:[e],t=t||{defaults:n.defaults},e.forEach(function(e){let n=p[e],r=a.get(e,t.defaults);n?n.set("container",r):u.warn(`不存在 ${r} 的 Panel 实例。`)})}}),t.exports=n=g}),I("Tabs/Events",function(e,t,n){const r=e("jquery");t.exports={bind(e){let{eventName:t,selector:n,pressedClass:i}=e;e.change=function(t){let r=this,i=e.$.find(n).toArray().findIndex(function(e){return e===r});e.this.active(i,{event:t})},"touch"!=t?(e.$.on(t,n,e.change),e.$.on("mousedown",n,function(e){r(this).addClass(i)}),e.$.on("mouseup mouseout",n,function(e){r(this).removeClass(i)})):e.$.touch(n,e.change,i)}}}),I("Tabs/Meta",function(e,t,n){const r=e("String");t.exports={create(e,t){let n={id:r.randomId("definejs-tabs-",4),activedClass:e.activedClass||"",pressedClass:e.pressedClass||"",eventName:e.eventName||"",selector:e.selector||"",repeated:!!e.repeated,list:e.list||[],current:{index:-1,item:null,event:null,$:null},container:null,tpl:null,emitter:null,this:null,$:null,change:null,reset(){n.$.find(n.selector).removeClass(n.activedClass),n.current={index:-1,item:null,event:null,$:null}},activing(e,t){t()}};return j.assign(n,t),n}}}),I("Tabs.defaults",function(e,t,n){t.exports={current:null,pressedClass:"",activedClass:"",eventName:"click",selector:">*",repeated:!1}}),I("Tabs",function(e,t,n){const r=e("jquery"),i=e("Object"),s=e("Emitter"),o=e("Template"),l=t.require("Events"),a=t.require("Meta"),u=new x;function c(e,t){i.isPlain(e)&&(e=(t=e).container),t=j.assign({},n.defaults,t);let o=new s(this),l=a.create(t,{container:e,this:this,emitter:o,$:r(e)});u.set(this,l),j.assign(this,{container:e,id:l.id,$:l.$})}c.prototype={constructor:c,container:"",id:"",$:null,template(e){let t=u.get(this),n=t.tpl;return n||(n=t.tpl=new o(t.container)),e&&n.process(...arguments),n},fill(e,t){let n=u.get(this),r=this.template(t).fill(e);return n.$.html(r),n.list=e,n.reset(),n.emitter.fire("fill",[e]),r},render(e,t){let n=u.get(this);n.change||l.bind(n),e&&this.fill(e,t),n.emitter.fire("render",[e])},active(e,t){let n=!0;"boolean"==typeof t?(n=t,t={}):t=t||{};let r=u.get(this),i=r.current;if(e==i.index&&!r.repeated)return;let s=r.list[e]||null,o=r.activedClass,l=j.assign({},i);i.$&&i.$.removeClass(o),i.index=e,i.item=s,i.event=t.event,i.$=r.$.find(`${r.selector}:eq(${e})`);let a={current:i,old:l,options:t};r.activing(a,function(){if(i.$.addClass(o),!n)return;let t=[s,e,a],l=s&&s.cmd||"";r.emitter.fire("before-change",t),r.emitter.fire("change",`${e}`,t),l&&r.emitter.fire("change",l,t),r.emitter.fire("change",t)})},remove(e){let t=u.get(this),n=t.current.index;t.fire("before-remove",[e]),e<n?this.active(n-1,!1):e==n&&t.reset(),t.list.splice(e,1),t.fire("remove",[e])},reset(){u.get(this).reset()},getActivedIndex(){return u.get(this).current.index},activing(e){let t=u.get(this);if("function"!=typeof(e=e||t.activing))throw new m("参数 fn 必须为 function 类型。");return t.activing=e,e},on(...e){u.get(this).emitter.on(...e)},destroy(){let e=u.get(this);e.emitter.destroy(),e.tpl.destroy(),e.$.off(),u.delete(this)}},c.defaults=e("Tabs.defaults"),t.exports=n=c}),I("Toast/Masker",function(e,t,n){const r=e("Masker");t.exports={create(e){let t={container:e.container},n=r.normalize(t,e.mask);return n?(j.assign(n,{"z-index":e["z-index"]-1}),new r(n)):null}}}),I("Toast/Meta",function(e,t,n){const r=e("String"),i="definejs-toast-";t.exports={create(e,t){let n=r.randomId(i,4),s=r.randomId(i,"text-",4),o=r.randomId(i,"icon-",4),l=e.text;l=(l="number"==typeof l?C(l):l)||"";let a={id:n,icon:e.icon,text:l,textId:s,iconId:o,cssClass:e.cssClass||"",container:e.container,duration:e.duration||0,sample:"",style:"",masker:null,emitter:null,this:null,$:null,$icon:null,$text:null};return j.assign(a,t),a}}}),I("Toast/Sample",function(e,t,n){t.exports='\n        <div id="{id}" class="definejs-toast {cssClass}" style="{style}">\n            <div>\n                <i id="{iconId}" class="fa fa-{icon}"></i>\n            </div>\n            <span id="{textId}" class="Text">{text}</span>\n        </div>\n    \n    '}),I("Toast/Style",function(e,t,n){const r=e("Object"),i=e("Style");t.exports={get(e){let t=r.filter(e,["height","width","z-index"]),n=i.objectify(e.style);return n=i.merge(n,t),n=i.pixelize(n,["height","width"])}}}),I("Toast.defaults",function(e,t,n){t.exports={text:"",container:"body",mask:!1,icon:"check",duration:0,cssClass:"","z-index":1024,width:"",height:"",style:{}}}),I("Toast",function(e,t,n){const r=e("jquery"),i=e("Object"),s=e("String"),o=e("Style"),l=e("Emitter"),a=t.require("Sample"),u=t.require("Style"),c=t.require("Meta"),d=t.require("Masker"),h=new x;function p(e){e=i.deepAssign({},n.defaults,e);let t=new l(this),r=u.get(e),s=d.create(e),o=c.create(e,{sample:a,style:r,emitter:t,masker:s,this:this});h.set(this,o),j.assign(this,{id:o.id})}p.prototype={constructor:p,id:"",$:null,render(){let e=h.get(this);if(e.$)return;let t=o.stringify(e.style),n=s.format(e.sample,{id:e.id,icon:e.icon,text:e.text,textId:e.textId,iconId:e.iconId,cssClass:e.cssClass,style:t});r(e.container).append(n),e.$=this.$=r(`#${e.id}`),e.$icon=r(`#${e.iconId}`),e.$text=r(`#${e.textId}`),e.emitter.fire("render")},show(e,t){"function"==typeof e&&(t=e,e=S);let n=h.get(this),r=n.masker,i=n.duration;n.$||this.render(),r&&r.show(),"string"==typeof e&&(n.text=e,n.$text.html(e)),i&&f(function(){n.this.hide(),t&&t()},i),n.$.toggleClass("NoIcon",!n.icon),n.$.toggleClass("NoText",!n.text),n.$.show(),n.emitter.fire("show")},hide(){let e=h.get(this),t=e.masker;e.$&&(t&&t.hide(),e.$.hide(),e.emitter.fire("hide"))},remove(){let e=h.get(this);if(!e.$)return;let t=e.$.get(0),n=e.masker;t.parentNode.removeChild(t),n&&n.remove(),e.$.off(),e.$=this.$=null,e.$icon=null,e.$text=null,e.masker=null,e.emitter.fire("remove")},on(...e){h.get(this).emitter.on(...e)},destroy(){let e=h.get(this);this.remove(),e.emitter.destroy(),h.remove(this)}},p.defaults=e("Toast.defaults"),t.exports=n=p}),I("View.defaults",function(e,t,n){t.exports={ViewSlider:null,container:'[data-view="{id}"]',background:""}}),I("View",function(e,t,n){const r=e("Panel");function i(e,t){t=j.assign({},n.defaults,t),r.call(this,e,t),this.$.addClass("definejs-view"),t.background&&this.$.css("background",t.background),t.fullscreen&&this.$.addClass("FullScreen")}i.prototype=j.assign(new r,{slider:function(e){let t=n.defaults.ViewSlider;t&&t.slide(this,e)}}),j.assign(i,{defaults:e("View.defaults"),define:function(e,t){r.define(e,t,{constructor:i,defaults:n.defaults})},update:function(e){r.update(e,{defaults:n.defaults})}}),t.exports=n=i}),I("jquery",function(t,n,r){return e.jQuery}),I("circular-json",function(e,t,n){var r="~",i="\\x"+("0"+r.charCodeAt(0).toString(16)).slice(-2),s="\\"+i,o=new k(i,"g"),l=new k(s,"g"),a=new k("(?:^|([^\\\\]))"+s),u=[].indexOf||function(e){for(var t=this.length;t--&&this[t]!==e;);return t},c=C;function f(e,t,n){return t instanceof h?function(e,t,n){for(var r=0,i=t.length;r<i;r++)t[r]=f(e,t[r],n);return t}(e,t,n):t instanceof c?t.length?n.hasOwnProperty(t)?n[t]:n[t]=function(e,t){for(var n=0,i=t.length;n<i;e=e[t[n++].replace(l,r)]);return e}(e,t.split(r)):e:t instanceof j?function(e,t,n){for(var r in t)t.hasOwnProperty(r)&&(t[r]=f(e,t[r],n));return t}(e,t,n):t}var d={stringify:function(e,t,n,l){return d.parser.stringify(e,function(e,t,n){var l,a,c=!1,f=!!t,d=[],h=[e],p=[e],g=[n?r:"[Circular]"],m=e,y=1;return f&&(a="object"==typeof t?function(e,n){return""!==e&&t.indexOf(e)<0?void 0:n}:t),function(e,t){return f&&(t=a.call(this,e,t)),c?(m!==this&&(l=y-u.call(h,this)-1,y-=l,h.splice(y,h.length),d.splice(y-1,d.length),m=this),"object"==typeof t&&t?(u.call(h,t)<0&&h.push(m=t),y=h.length,(l=u.call(p,t))<0?(l=p.push(t)-1,n?(d.push((""+e).replace(o,i)),g[l]=r+d.join(r)):g[l]=g[0]):t=g[l]):"string"==typeof t&&n&&(t=t.replace(i,s).replace(r,i))):c=!0,t}}(e,t,!l),n)},parse:function(e,t){return d.parser.parse(e,function(e){return function(t,n){var o="string"==typeof n;return o&&n.charAt(0)===r?new c(n.slice(1)):(""===t&&(n=f(n,n,{})),o&&(n=n.replace(a,"$1"+r).replace(s,i)),e?e.call(this,t,n):n)}}(t))},parser:w};t.exports=d}),T.each(function(e){M.define(e,function(t,n,r){return T.require(e)})});const N=function({require:e,bind:t}){let n={require:e,create:(t,...n)=>new(e(t))(...n)},r=n.packages={"@definejs/alert":"Alert","@definejs/api":"API","@definejs/app":"App","@definejs/app-module":"AppModule","@definejs/array":"Array","@definejs/confirm":"Confirm","@definejs/date":"Date","@definejs/defaults":"Defaults","@definejs/dialog":"Dialog","@definejs/emitter":"Emitter","@definejs/escape":"Escape","@definejs/fn":"Fn","@definejs/hash":"Hash","@definejs/html-parser":"HTMLParser","@definejs/json":"JSON","@definejs/loading":"Loading","@definejs/local-storage":"LocalStorage","@definejs/masker":"Masker","@definejs/math":"Math","@definejs/module-manager":"ModuleManager","@definejs/navigator":"Navigator","@definejs/object":"Object","@definejs/package":"Package","@definejs/panel":"Panel","@definejs/proxy":"Proxy","@definejs/query":"Query","@definejs/script":"Script","@definejs/session-storage":"SessionStorage","@definejs/string":"String","@definejs/style":"Style","@definejs/tabs":"Tabs","@definejs/tasker":"Tasker","@definejs/template":"Template","@definejs/timer":"Timer","@definejs/toast":"Toast","@definejs/tree":"Tree","@definejs/url":"Url","@definejs/view":"View"};n.modules=j.values(r).sort(),n.alert=t("Alert","show"),n.confirm=t("Confirm","show"),n.config=t("Defaults","config"),n.data=t("AppModule","data"),n.launch=t("App","launch"),n.load=t("Package","load"),n.panel=t("Panel","define"),n.proxy=t("Proxy","response"),n.route=t("App","route"),n.view=t("View","define"),n.create=function(t,...n){return new(e(t))(...n)};let i=e("AppModule").mm(),s=i.require.bind(i);return i.require=function(t,...n){if(!t.startsWith("@definejs/"))return s(t,...n);let i=r[t];if(!i)throw new m(`此打包的 '@definejs/' 域中不存在 '${t}' 对应的主模块。`);return e(i)},n}(M);e.definejs?j.assign(e.definejs,N):e.definejs=N}(window,top,parent,window,document,location,navigator,localStorage,sessionStorage,console,history,setTimeout,setInterval,Array,Boolean,Date,Error,Function,JSON,Map,Math,Number,Object,RegExp,String,void 0);